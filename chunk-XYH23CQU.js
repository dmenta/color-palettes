import{a as ne,b as f,c as n,d as se,e as N,g as ae,h as le,j as he,k as ce,l as de}from"./chunk-LYFKLKSK.js";import{a as te,f as T,m as ie,n as re}from"./chunk-AG74TOS6.js";import{$a as J,Ca as H,L,La as m,Ma as E,Na as G,O as W,T as g,Ua as l,Va as p,Wa as y,Xa as Y,Z as $,Za as S,_ as K,a as C,ab as U,b as D,bb as Z,bc as oe,ha as j,ja as c,kb as ee,p as w,ta as d,u as b,v as V,vb as u,w as B,wa as Q,wb as P,xa as X,z as k}from"./chunk-MLHRJ3PS.js";var M=class{constructor(e,t,o,i){this.imageContext=e;this.size=t;this.colors=o;this.config=i;this.canvas=new OffscreenCanvas(t,t);let r=this.canvas.getContext("2d");r.imageSmoothingQuality="high",r.imageSmoothingEnabled=!0,this.ctx=r,this.start=n.point({x:0,y:this.size}),this.end=n.point({x:this.size,y:0}),this.vertices={h1:this.start,h2:this.start,h3:this.end,h4:this.end}}ctx;start;end;vertices;canvas;handlersToCanvas(e){return{h1:this.pointToCanvas(e.h1),h2:this.pointToCanvas(e.h2),h3:this.pointToCanvas(e.h3),h4:this.pointToCanvas(e.h4)}}oppositeHandler(e,t,o){let i=e.y-t.y,r=e.x-t.x;i=Math.abs(i)<.25?Math.sign(i)*.25:i,r=Math.abs(r)<.25?Math.sign(r)*.25:r;let s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2)),h=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2));return n.point({x:e.x+r/s*h,y:e.y+i/s*h})}draw(e,t,o,i){let r=this.pointToCanvas(i);this.vertices.h2=r,this.vertices.h3=r;let s=this.handlersToCanvas(e);this.drawGrid(o);let h=t==="h2"?"h3":t==="h3"?"h2":null,v=t==="h1"?"h1":"h2",A=v==="h1"?"h2":"h1";this.drawHandler(this.vertices[A],s[A],this.colors.handler(A,o),!1),this.drawHandler(this.vertices[v],s[v],this.colors.handler(v,o),t===v,h===v);let x=t==="h4"?"h4":"h3",I=x==="h4"?"h3":"h4";this.drawHandler(this.vertices[I],s[I],this.colors.handler(I,o),!1),this.drawHandler(this.vertices[x],s[x],this.colors.handler(x,o),t===x,h===x),this.drawBezier(this.start,r,s.h1,s.h2,o,t!==null),this.drawBezier(r,this.end,s.h3,s.h4,o,t!==null),this.drawCenterHandler(r,this.colors.center(o),t==="center");let pe=this.canvas.transferToImageBitmap();this.imageContext.transferFromImageBitmap(pe)}drawBezier(e,t,o,i,r,s){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.strokeStyle=this.colors.curve(r),this.ctx.bezierCurveTo(o.x,o.y,i.x,i.y,t.x,t.y),this.ctx.lineWidth=this.config.widthFactor*(s!==null?3:2),this.ctx.stroke()}drawGrid(e){let t=this.colors.grid(e),o=this.size/this.config.virtualSize;this.ctx.beginPath(),this.ctx.rect(0,0,n.value(o*this.config.virtualSize),n.value(o*this.config.virtualSize)),this.ctx.strokeStyle=t.border,this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.stroke(),this.ctx.strokeStyle=t.lines,this.ctx.setLineDash([1,3]);for(let i=10;i<this.config.virtualSize;i+=this.config.virtualSize/this.config.gridLines)this.ctx.beginPath(),this.ctx.moveTo(0,n.value(i*o)),this.ctx.lineTo(this.size,n.value(i*o)),this.ctx.lineWidth=n.value(this.config.widthFactor*.5),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(n.value(i*o),0),this.ctx.lineTo(n.value(i*o),this.size),this.ctx.lineWidth=n.value(this.config.widthFactor*.5),this.ctx.stroke();this.ctx.setLineDash([])}drawCenterHandler(e,t,o){o&&(this.ctx.shadowColor=t.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset,o&&this.drawCenterHandlerActive(e,t)),this.ctx.beginPath(),this.ctx.fillStyle=o?t.active:t.main,this.ctx.fillRect(n.value(e.x-this.config.handlerRadius),n.value(e.y-this.config.handlerRadius),n.value(this.config.handlerRadius*2),n.value(this.config.handlerRadius*2)),this.ctx.shadowColor="transparent"}drawCenterHandlerActive(e,t){let o=this.config.handlerRadius*3;this.ctx.beginPath(),this.ctx.rect(n.value(e.x-o/2),n.value(e.y-o/2),n.value(o),n.value(o)),this.ctx.strokeStyle=t.activeBorder,this.ctx.lineWidth=n.value(this.config.widthFactor*2),this.ctx.stroke()}drawHandler(e,t,o,i,r=!1){(i||r)&&(this.ctx.shadowColor=o.common.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset,i&&this.drawHandlerActive(t,o)),this.drawHandlerLine(e,t,o,i),r||(this.ctx.shadowColor="transparent"),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.config.handlerRadius,0,Math.PI*2),this.ctx.fillStyle=o.main,this.ctx.fill(),this.ctx.shadowColor="transparent"}drawHandlerActive(e,t){this.ctx.beginPath(),this.ctx.arc(e.x,e.y,this.config.activeHandlerRadius,0,Math.PI*2),this.ctx.strokeStyle=t.main,this.ctx.lineWidth=n.value(this.config.widthFactor*2),this.ctx.stroke()}drawHandlerLine(e,t,o,i){this.ctx.beginPath(),this.ctx.lineWidth=n.value(this.config.widthFactor*(i?1.5:1)),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=i?o.common.activeline:o.common.line,this.ctx.stroke()}pointFromCanvas(e){let t=this.config.virtualSize/this.size;return n.point({x:n.value(Math.max(0,Math.min(e.x,this.size))*t),y:n.value(Math.max(0,Math.min(this.size-e.y,this.size))*t)})}pointToCanvas(e){let t=this.size/this.config.virtualSize;return n.point({x:Math.max(0,Math.min(e.x,this.config.virtualSize))*t,y:this.size-Math.max(0,Math.min(e.y,this.config.virtualSize))*t})}};var z={widthFactor:1,activeHandlerRadius:10,handlerRadius:7,virtualSize:2e3,activeHandlerShadowBlur:7,activeHandlerShadowOffset:5,gridLines:20};var ve={light:{h1:{main:"oklch(0.355 0.146 29)"},h2:{main:"oklch(0.377 0.1 247)"},h3:{main:"oklch(0.355 0.146 29)"},h4:{main:"oklch(0.377 0.1 247)"},common:{line:"#305030",activeline:"#008000",shadow:"#202020"}},dark:{h1:{main:"oklch(0.634 0.254 18)"},h2:{main:"oklch(0.858 0.146 197)"},h3:{main:"oklch(0.634 0.254 18)"},h4:{main:"oklch(0.858 0.146 197)"},common:{line:"#E0FFE0",activeline:"#80FF80",shadow:"#202020"}}},Ce={light:"#303030",dark:"#D0D0D0"},be={light:{main:"#606060",active:"#202020",activeBorder:"#FF5000",shadow:"#404040"},dark:{main:"#A0A0A0",active:"#b0b0b0",activeBorder:"#C0CC00",shadow:"#202020"}},ge={light:{lines:"#606060",border:"#101010"},dark:{lines:"#C0C0C0",border:"#F0F0F0"}},fe={handlerColors:ve,curveColor:Ce,gridColors:ge,centerColors:be},F=class{colors=fe;handler(e,t){let o=t?this.colors.handlerColors.dark:this.colors.handlerColors.light;return{main:o[e].main,common:o.common}}curve(e){return e?this.colors.curveColor.dark:this.colors.curveColor.light}grid(e){return e?this.colors.gridColors.dark:this.colors.gridColors.light}center(e){return e?this.colors.centerColors.dark:this.colors.centerColors.light}};var ze=["canvas"],_=class a{constructor(e){this.renderer=e;P(()=>{this.dibujar(this.state.handlers(),this.state.center(),this.currentHandler(),this.darkMode())})}mouseMoveSubscription=null;moveSubscription=null;startSubscription=null;removeDocumentClickListenerFn=null;removeDocumentTouchEndListenerFn=null;state=g(f);overHandler=c(null);currentHandler=c(null);size=j(200);darkMode=j(!1);canvas;doubleBezier=null;ngAfterViewInit(){this.doubleBezier=new M(this.canvas.nativeElement.getContext("bitmaprenderer"),this.size(),new F,z),this.mouseMoveSubscription=b(this.canvas.nativeElement,"mousemove").pipe(B(()=>this.currentHandler()===null),k(5),w(e=>e)).subscribe(e=>{this.onMouseMove(e)}),this.moveSubscription=V(b(document,"mousemove"),b(document,"touchmove",{passive:!1})).pipe(B(()=>this.currentHandler()!==null),L(e=>e.preventDefault()),k(1),w(e=>e)).subscribe(e=>{this.onMoveHandler(e)}),this.startSubscription=V(b(this.canvas?.nativeElement,"mousedown").pipe(w(e=>e)),b(this.canvas?.nativeElement,"touchstart",{passive:!1}).pipe(w(e=>{let t=this.pointFromEvent(e);return this.isOverHandler(t)!==null?e:null}),B(e=>e!==null),L(e=>e.preventDefault()))).pipe(B(()=>this.currentHandler()===null),k(1)).subscribe(e=>{this.onGrabHandler(e)}),this.canvas.nativeElement.oncontextlost=e=>{console.warn("Context lost",e)},this.dibujar(this.state.handlers())}onDoubleClick(e){let t=this.overHandler();if(t===null||t==="center")return;let o={h1:1,h2:2,h3:4,h4:5},i=n.value(o[t]/6*z.virtualSize);t==="h3"||t==="h4"?this.state.onHandlersChange(D(C({},this.state.handlers()),{[t]:{x:i,y:i}})):this.state.onHandlersChange(D(C({},this.state.handlers()),{[t]:{x:i,y:i}}))}onGrabHandler(e){let t=this.pointFromEvent(e),o=this.isOverHandler(t);o!==null&&this.setHandlerSelected(o)}onMoveHandler(e){let t=this.pointFromEvent(e);this.updateHandlerCoords(t)}onMouseMove(e){let t=this.pointFromEvent(e),o=this.overHandler(),i=this.isOverHandler(t);o!==i&&this.overHandler.set(i)}stopTracking(){this.currentHandler()!==null&&(this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.currentHandler.set(null))}setHandlerSelected(e){this.setListeners(),this.currentHandler.set(e)}updateHandlerCoords(e){let t=this.currentHandler();if(t!==null){if(t==="center"){let o=e.x-this.state.center().x,i=e.y-this.state.center().y,r=this.state.handlers().h2,s=this.state.handlers().h3,h=n.point({x:r.x+o,y:r.y+i}),v=n.point({x:s.x+o,y:s.y+i});this.state.onCenterChange(n.point(e)),this.state.onHandlersChange(D(C({},this.state.handlers()),{h2:h,h3:v}));return}if(t==="h1"||t==="h4")this.state.onHandlersChange(D(C({},this.state.handlers()),{[t]:e}));else{let o=t==="h2"?"h3":"h2",i=this.doubleBezier?.oppositeHandler(this.state.center(),e,this.state.handlers()[o]);this.state.onHandlersChange(D(C({},this.state.handlers()),{[t]:{x:Math.round(e.x),y:Math.round(e.y)},[o]:{x:i.x,y:i.y}}))}}}isOverHandler(e){let t=this.state.handlers(),o=["h1","h2","h3","h4"],i=z.handlerRadius/this.size()*z.virtualSize;for(let r=1;r<=8;r++){if(N(e,this.state.center(),i*r))return"center";for(let s=0;s<o.length;s++){let h=o[s];if(N(e,t[h],i*r))return h}}return null}setListeners(){this.removeDocumentClickListenerFn=this.renderer.listen("document","mouseup",()=>this.stopTracking()),this.removeDocumentTouchEndListenerFn=this.renderer.listen("document","touchend",()=>this.stopTracking(),{passive:!0})}dibujar(e,t=this.state.center(),o=this.currentHandler(),i=this.darkMode()){if(!this.doubleBezier)return;let r=this.doubleBezier;requestAnimationFrame(()=>{r.draw(e,o,i,t)})}pointFromEvent(e){if(!this.doubleBezier)return{x:0,y:0};let t=se.pointFromEvent(this.canvas.nativeElement,e);return this.doubleBezier.pointFromCanvas(t)}ngOnDestroy(){this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.mouseMoveSubscription?.unsubscribe(),this.moveSubscription?.unsubscribe(),this.startSubscription?.unsubscribe()}static \u0275fac=function(t){return new(t||a)(X(Q))};static \u0275cmp=H({type:a,selectors:[["zz-double-bezier-panel"]],viewQuery:function(t,o){if(t&1&&J(ze,5),t&2){let i;U(i=Z())&&(o.canvas=i.first)}},inputs:{size:[1,"size"],darkMode:[1,"darkMode"]},decls:3,vars:8,consts:[["canvas",""],["id","canvas",1,"bg-gris-500/20","rounded-lg",3,"dblclick","width","height"]],template:function(t,o){if(t&1){let i=Y();l(0,"div")(1,"canvas",1,0),S("dblclick",function(s){return $(i),K(o.onDoubleClick(s))}),p()()}t&2&&(d(),E("padding",o.size()/20,"px"),G("cursor-grab",o.overHandler()!==null)("cursor-grabbing",o.currentHandler()!==null),m("width",o.size())("height",o.size()))},encapsulation:2,changeDetection:0})};var R=class a{store=g(te);initialState=this.store.get("double-gradient-state")??he;angleDegrees=c(this.initialState.angle);startRGBColor=c(this.initialState.colors.start);centerRGBColor=c(this.initialState.colors.center);endRGBColor=c(this.initialState.colors.end);center=c(this.initialState.center);handlers=c(this.initialState.handlers);startOklch=u(()=>T(this.rgbText(this.startRGBColor())));centerOklch=u(()=>T(this.rgbText(this.centerRGBColor())));endOklch=u(()=>T(this.rgbText(this.endRGBColor())));points=u(()=>ce.doublePoints(this.handlers(),this.center(),z.virtualSize));startColor=u(()=>this.oklchText(this.startOklch()));centerColor=u(()=>this.oklchText(this.centerOklch()));endColor=u(()=>this.oklchText(this.endOklch()));gradient=u(()=>ae(this.startOklch(),this.centerOklch(),this.endOklch(),this.points(),this.angleDegrees()));currentState=u(()=>({colors:{start:this.startRGBColor(),center:this.centerRGBColor(),end:this.endRGBColor()},center:this.center(),handlers:this.handlers(),angle:this.angleDegrees()}));constructor(){P(()=>this.store.save("double-gradient-state",this.currentState()))}onAngleDegreesChange(e){this.angleDegrees.set(e)}onStartColorChange(e){this.startRGBColor.set(e)}onCenterColorChange(e){this.centerRGBColor.set(e)}onEndColorChange(e){this.endRGBColor.set(e)}onCenterChange(e){this.center.set(e)}onHandlersChange(e){this.handlers.set(C({},e))}rgbText(e){return`rgb(${Math.round(e[0])} ${Math.round(e[1])} ${Math.round(e[2])})`}oklchText(e){return`oklch(${e[0].toFixed(3)} ${e[1].toFixed(3)} ${e[2].toFixed(1)})`}static \u0275fac=function(t){return new(t||a)};static \u0275prov=W({token:a,factory:a.\u0275fac,providedIn:"root"})};var O=class a{state=g(f);onColorEndChange(e){this.state.onEndColorChange(e)}onColorCenterChange(e){this.state.onCenterColorChange(e)}onColorStartChange(e){this.state.onStartColorChange(e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=H({type:a,selectors:[["zz-double-gradient-colors"]],hostAttrs:[1,"w-full"],decls:4,vars:6,consts:[[1,"flex","flex-row","items-center","justify-center","gap-2","w-full"],[1,"shadow-md",3,"color-changing","border","color"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"zz-color-selector",1),S("color-changing",function(r){return o.onColorStartChange(r)}),p(),l(2,"zz-color-selector",1),S("color-changing",function(r){return o.onColorCenterChange(r)}),p(),l(3,"zz-color-selector",1),S("color-changing",function(r){return o.onColorEndChange(r)}),p()()),t&2&&(d(),m("border","border-current/40")("color",o.state.startRGBColor()),d(),m("border","border-current/40")("color",o.state.centerRGBColor()),d(),m("border","border-current/40")("color",o.state.endRGBColor()))},dependencies:[ie],encapsulation:2,changeDetection:0})};var me=class a{state=g(f);bezierSize=280;compassSize=130;ngOnInit(){b(document,"touchstart",{passive:!0}).subscribe(()=>{this.requestFullscreen()})}requestFullscreen(){document.fullscreenElement||document.documentElement.requestFullscreen().catch(()=>{console.debug("Error attempting to enable full-screen mode")})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=H({type:a,selectors:[["zz-double-bezier-gradient"]],features:[ee([{provide:f,useExisting:R}])],decls:12,vars:10,consts:[[1,"bg-application","w-screen","h-screen","overflow-hidden"],[1,"sticky","bg-application","z-20","top-0","left-0","right-0","shadow-md","dark:shadow-black/60"],[1,"w-screen","min-h-[calc(100vh_-_50px)]","grid","justify-center","place-content-start","auto-rows-auto","gap-4","px-4","pt-[10svh]","pb-8"],[3,"size","darkMode"],[1,"flex","items-center","gap-4","justify-center"],[1,"-ml-1",3,"size","darkMode"],[1,"flex","flex-col","items-center","gap-4","pr-1"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"div",1),y(2,"zz-gradients-header"),p(),l(3,"main",2)(4,"div"),y(5,"zz-double-bezier-panel",3),l(6,"div",4),y(7,"zz-orientation-compass",5),l(8,"div",6),y(9,"zz-double-gradient-colors")(10,"zz-gradient-actions"),p()()()()(),y(11,"zz-notification")),t&2&&(d(3),E("background",o.state.gradient().gradient),G("text-gris-900",!o.state.gradient().darkMode)("text-gris-100",o.state.gradient().darkMode),d(2),m("size",o.bezierSize)("darkMode",o.state.gradient().darkMode),d(2),m("size",o.compassSize)("darkMode",o.state.gradient().darkMode))},dependencies:[re,ne,oe,_,le,de,O],encapsulation:2,changeDetection:0})};export{me as DoubleBezierGradientComponent};
