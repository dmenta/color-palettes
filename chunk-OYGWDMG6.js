import{a as ie,b as E,c as oe,d as a,e as ae,f as V,g as se,h as le,i as de,k as ue,l as ce}from"./chunk-ZJHOMXJZ.js";import{a as te,f as L,n as re}from"./chunk-AG74TOS6.js";import{$a as J,Ca as k,L as x,La as S,Ma as D,Na as T,O as W,T as h,Ua as m,Va as z,Wa as v,Xa as X,Z as $,Za as Y,_ as q,a as C,ab as U,b as R,bb as Z,bc as ne,ha as I,ja as u,kb as ee,p as b,ta as p,u as d,v as O,vb as c,w as H,wa as Q,wb as M,xa as K,z as y}from"./chunk-MLHRJ3PS.js";function me(t){return{h1:t?"oklch(0.634 0.254 18)":"oklch(0.355 0.146 29)",h2:t?"oklch(0.858 0.146 197)":"oklch(0.377 0.1 247)",line:t?"#E0FFE0":"#305030",activeline:t?"#80FF80":"#008000",shadow:t?"#000000":"#202020"}}function he(t){return t?"#D0D0D0":"#303030"}function pe(t){return{lines:t?"#C0C0C0":"#606060",border:t?"#F0F0F0":"#101010"}}var f=1,ye=18,_=10,s=2e3,ke=7,ve=5,fe=10;function Ce(t,e,n,r,i){let l=new OffscreenCanvas(n,n),o=l.getContext("2d");o.imageSmoothingQuality="high",o.imageSmoothingEnabled=!0,De(o,n,i);let A=me(i),ze=he(i),F=a.point({x:0,y:n}),G=a.point({x:n,y:0}),N={h1:F,h2:G},g=r??"h1",B=g==="h2"?"h1":"h2";ge(o,N[B],e[B],A,B,!1),ge(o,N[g],e[g],A,g,r===g),o.beginPath(),o.moveTo(F.x,F.y),o.strokeStyle=ze,o.bezierCurveTo(e.h1.x,e.h1.y,e.h2.x,e.h2.y,G.x,G.y),o.lineWidth=f*(r!==null?3:2),o.stroke();let Ee=l.transferToImageBitmap();t.transferFromImageBitmap(Ee)}function De(t,e,n){let r=pe(n),i=e/s;t.beginPath(),t.rect(0,0,a.value(i*s),a.value(i*s)),t.strokeStyle=r.border,t.lineWidth=a.value(f*1),t.stroke(),t.strokeStyle=r.lines,t.setLineDash([1,3]);let l=s/fe;for(let o=s/fe;o<s;o+=l)t.beginPath(),t.moveTo(0,a.value(o*i)),t.lineTo(e,a.value(o*i)),t.lineWidth=a.value(f*.5),t.stroke(),t.beginPath(),t.moveTo(a.value(o*i),0),t.lineTo(a.value(o*i),e),t.lineWidth=a.value(f*.5),t.stroke();t.setLineDash([])}function ge(t,e,n,r,i,l){Me(t,e,n,r,l),t.beginPath(),t.arc(n.x,n.y,_,0,Math.PI*2),t.fillStyle=r[i],t.fill(),l&&Te(t,n,r,i)}function Te(t,e,n,r){t.shadowColor=n.shadow,t.shadowBlur=ke,t.shadowOffsetX=ve,t.shadowOffsetY=ve,t.beginPath(),t.arc(e.x,e.y,ye,0,Math.PI*2),t.strokeStyle=n[r],t.lineWidth=a.value(f*2),t.stroke(),t.shadowColor="transparent"}function Me(t,e,n,r,i){t.beginPath(),t.lineWidth=a.value(f*(i?1.5:1)),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.strokeStyle=i?r.activeline:r.line,t.stroke()}function be(t,e){let n=s/e;return a.point({x:a.value(Math.max(0,Math.min(t.x,e))*n),y:a.value(Math.max(0,Math.min(e-t.y,e))*n)})}function j(t,e){let n=e/s;return a.point({x:Math.max(0,Math.min(t.x,s))*n,y:e-Math.max(0,Math.min(t.y,s))*n})}var Pe=["canvas"],w=class t{constructor(e){this.renderer=e;M(()=>{let n=this.handlersToCanvas(this.state.handlers());this.dibujar(n,this.currentHandler(),this.size(),this.darkMode())})}mouseMoveSubscription=null;moveSubscription=null;startSubscription=null;removeDocumentClickListenerFn=null;removeDocumentTouchEndListenerFn=null;state=h(E);overHandler=u(null);currentHandler=u(null);size=I(200);darkMode=I(!1);canvas;canvasContext=null;canvasRealSize=0;ngAfterViewInit(){this.mouseMoveSubscription=d(this.canvas.nativeElement,"mousemove").pipe(H(()=>this.currentHandler()===null),y(5),b(e=>e)).subscribe(e=>{this.onMouseMove(e)}),this.moveSubscription=O(d(document,"mousemove"),d(document,"touchmove",{passive:!1})).pipe(H(()=>this.currentHandler()!==null),x(e=>e.preventDefault()),y(1),b(e=>e)).subscribe(e=>{this.onMoveHandler(e)}),this.startSubscription=O(d(this.canvas?.nativeElement,"mousedown").pipe(b(e=>e)),d(this.canvas?.nativeElement,"touchstart",{passive:!1}).pipe(b(e=>{let n=this.pointFromEvent(e);return this.isOverHandler(n)!==null?e:null}),H(e=>e!==null),x(e=>e.preventDefault()))).pipe(H(()=>this.currentHandler()===null),y(1)).subscribe(e=>{this.onGrabHandler(e)}),this.canvas.nativeElement.oncontextlost=e=>{console.warn("Context lost",e)},this.canvasRealSize=this.realSize(),this.dibujar(this.handlersToCanvas(this.state.handlers()))}onDoubleClick(e){let n=this.overHandler();if(n===null)return;let r=a.value((n==="h1"?1:2)/3*s);this.state.onHandlersChange(R(C({},this.state.handlers()),{[n]:{x:r,y:r}}))}onGrabHandler(e){let n=this.pointFromEvent(e),r=this.isOverHandler(n);r!==null&&this.setHandlerSelected(r)}onMoveHandler(e){let n=this.pointFromEvent(e);this.updateHandlerCoords(n)}onMouseMove(e){let n=this.pointFromEvent(e),r=this.overHandler(),i=this.isOverHandler(n);r!==i&&this.overHandler.set(i)}stopTracking(){this.currentHandler()!==null&&(this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.currentHandler.set(null))}setHandlerSelected(e){this.setListeners(),this.currentHandler.set(e)}updateHandlerCoords(e){let n=this.currentHandler();n!==null&&this.state.onHandlersChange(R(C({},this.state.handlers()),{[n]:e}))}isOverHandler(e){let n=this.state.handlers(),r=_/this.size()*s;for(let i=1;i<=8;i++){if(V(e,n.h1,r*i))return"h1";if(V(e,n.h2,r*i))return"h2"}return null}setListeners(){this.removeDocumentClickListenerFn=this.renderer.listen("document","mouseup",()=>this.stopTracking()),this.removeDocumentTouchEndListenerFn=this.renderer.listen("document","touchend",()=>this.stopTracking(),{passive:!0})}dibujar(e,n=this.currentHandler(),r=this.size(),i=this.darkMode()){if(!this.canvas)return;this.canvasContext===null&&(this.canvasContext=this.canvas.nativeElement.getContext("bitmaprenderer"));let l=this.canvasContext;requestAnimationFrame(()=>{Ce(l,e,r,n,i)})}handlersToCanvas(e){return{h1:j(e.h1,this.size()),h2:j(e.h2,this.size())}}pointFromEvent(e){let n=ae.pointFromEvent(this.canvas.nativeElement,e);return be(n,this.canvasRealSize)}realSize(){let e=this.canvas?.nativeElement,n=window.getComputedStyle(e),i=2*(parseFloat(n.paddingBottom.replace("px",""))||0),l=e.getBoundingClientRect();return l.bottom-l.top-i}ngOnDestroy(){this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.mouseMoveSubscription?.unsubscribe(),this.moveSubscription?.unsubscribe(),this.startSubscription?.unsubscribe()}static \u0275fac=function(n){return new(n||t)(K(Q))};static \u0275cmp=k({type:t,selectors:[["zz-bezier-panel"]],viewQuery:function(n,r){if(n&1&&J(Pe,5),n&2){let i;U(i=Z())&&(r.canvas=i.first)}},inputs:{size:[1,"size"],darkMode:[1,"darkMode"]},decls:3,vars:8,consts:[["canvas",""],["id","canvas",1,"bg-gris-500/20","rounded-lg",3,"dblclick","width","height"]],template:function(n,r){if(n&1){let i=X();m(0,"div")(1,"canvas",1,0),Y("dblclick",function(o){return $(i),q(r.onDoubleClick(o))}),z()()}n&2&&(p(),D("padding",r.size()/20,"px"),T("cursor-grab",r.overHandler()!==null)("cursor-grabbing",r.currentHandler()!==null),S("width",r.size())("height",r.size()))},encapsulation:2,changeDetection:0})};var P=class t{store=h(te);initialState=this.store.get("gradient-state")??de;angleDegrees=u(this.initialState.angle);startRGBColor=u(this.initialState.colors.start);endRGBColor=u(this.initialState.colors.end);handlers=u(this.initialState.handlers);startOklch=c(()=>L(this.rgbText(this.startRGBColor())));endOklch=c(()=>L(this.rgbText(this.endRGBColor())));points=c(()=>ue.points(this.handlers(),s,s));startColor=c(()=>this.oklchText(this.startOklch()));endColor=c(()=>this.oklchText(this.endOklch()));gradient=c(()=>se(this.startOklch(),this.endOklch(),this.points(),this.angleDegrees()));currentState=c(()=>({colors:{start:this.startRGBColor(),end:this.endRGBColor()},handlers:this.handlers(),angle:this.angleDegrees()}));constructor(){M(()=>this.store.save("gradient-state",this.currentState()))}onAngleDegreesChange(e){this.angleDegrees.set(e)}onStartColorChange(e){this.startRGBColor.set(e)}onEndColorChange(e){this.endRGBColor.set(e)}onHandlersChange(e){this.handlers.set(C({},e))}rgbText(e){return`rgb(${Math.round(e[0])} ${Math.round(e[1])} ${Math.round(e[2])})`}oklchText(e){return`oklch(${e[0].toFixed(3)} ${e[1].toFixed(3)} ${e[2].toFixed(1)})`}static \u0275fac=function(n){return new(n||t)};static \u0275prov=W({token:t,factory:t.\u0275fac,providedIn:"root"})};var Se=class t{state=h(E);bezierSize=280;compassSize=130;ngOnInit(){d(document,"touchstart",{passive:!0}).subscribe(()=>{this.requestFullscreen()})}requestFullscreen(){document.fullscreenElement||document.documentElement.requestFullscreen().catch(()=>{console.debug("Error attempting to enable full-screen mode")})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=k({type:t,selectors:[["zz-test-col"]],features:[ee([{provide:E,useExisting:P}])],decls:12,vars:10,consts:[[1,"bg-application","w-screen","h-screen","overflow-hidden"],[1,"sticky","bg-application","z-20","top-0","left-0","right-0","shadow-md","dark:shadow-black/60"],[1,"w-screen","min-h-[calc(100vh_-_50px)]","grid","justify-center","place-content-start","auto-rows-auto","gap-4","px-4","pt-[10svh]","pb-8"],[3,"size","darkMode"],[1,"flex","items-center","gap-4","justify-center"],[1,"-ml-1",3,"size","darkMode"],[1,"flex","flex-col","items-center","gap-4","pr-1"]],template:function(n,r){n&1&&(m(0,"div",0)(1,"div",1),v(2,"zz-gradients-header"),z(),m(3,"main",2)(4,"div"),v(5,"zz-bezier-panel",3),m(6,"div",4),v(7,"zz-orientation-compass",5),m(8,"div",6),v(9,"zz-gradient-colors")(10,"zz-gradient-actions"),z()()()()(),v(11,"zz-notification")),n&2&&(p(3),D("background",r.state.gradient().gradient),T("text-gris-900",!r.state.gradient().darkMode)("text-gris-100",r.state.gradient().darkMode),p(2),S("size",r.bezierSize)("darkMode",r.state.gradient().darkMode),p(2),S("size",r.compassSize)("darkMode",r.state.gradient().darkMode))},dependencies:[re,ie,ne,oe,w,le,ce],encapsulation:2,changeDetection:0})};export{Se as BezierGradientComponent};
