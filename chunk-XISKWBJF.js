import{a as n,b as ae,c as le,e as he,f as ce,g as I,h as de,i as ue,j as me,k as ve}from"./chunk-TDUHLWT2.js";import{c as E,j as re,k as ne,l as se}from"./chunk-4IRTWCP7.js";import{$ as ee,A as z,Ga as ie,L as b,M as m,N as C,O as S,P as X,Q as Y,S as $,T as Q,U as M,V as J,Z as U,_ as Z,_a as oe,a as v,b as D,ba as k,ca as G,d as y,e as p,f as _,g as H,h as B,k as A,la as te,m as L,o as g,p as j,q,t as c,ta as h,ua as P,wa as N,x as d,y as K,z as W}from"./chunk-62DWZ52Y.js";var T=class{constructor(e,t,i,o){this.imageContext=e;this.size=t;this.colors=i;this.config=o;this.canvas=new OffscreenCanvas(t,t);let r=this.canvas.getContext("2d");r.imageSmoothingQuality="high",r.imageSmoothingEnabled=!0,this.ctx=r,this.start=n.point({x:0,y:this.size}),this.end=n.point({x:this.size,y:0}),this.vertices={h1:this.start,h2:this.start,h3:this.end,h4:this.end}}handlersKeys=["h4","h3","h2","h1"];keysCentrales=["h3","h2","center"];ctx;start;end;vertices;canvas;handlersToCanvas(e){return{h1:this.pointToCanvas(e.h1),h2:this.pointToCanvas(e.h2),h3:this.pointToCanvas(e.h3),h4:this.pointToCanvas(e.h4)}}oppositeHandler(e,t,i){let o=e.y-t.y,r=e.x-t.x;o=Math.abs(o)<.25?Math.sign(o)*.25:o,r=Math.abs(r)<.25?Math.sign(r)*.25:r;let s=Math.sqrt(Math.pow(r,2)+Math.pow(o,2)),l=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return n.point({x:e.x+r/s*l,y:e.y+o/s*l})}draw(e,t,i,o){let r=this.pointToCanvas(o);this.vertices.h2=r,this.vertices.h3=r;let s=this.handlersToCanvas(e),l=t!==null,w=t==="center"||t==="h2"||t==="h3";this.ctx.save(),this.ctx.globalCompositeOperation="source-over";for(let f of this.handlersKeys.filter(Ce=>w?!this.keysCentrales.includes(Ce):!0))this.drawHandler(this.vertices[f],s[f],this.colors.handler(f,i));if(this.ctx.restore(),this.ctx.save(),l||(this.ctx.globalCompositeOperation="destination-over"),this.drawBezier(this.start,r,s.h1,s.h2,i,l),this.drawBezier(r,this.end,s.h3,s.h4,i,l),this.ctx.restore(),w)if(t==="center")this.drawSemiActiveHandlerSlim(this.vertices.h2,s.h2,this.colors.handler("h2",i)),this.drawSemiActiveHandlerSlim(this.vertices.h3,s.h3,this.colors.handler("h3",i)),this.drawCenterHandlerActive(r,this.colors.center(i));else{let f=t==="h2"?"h3":"h2";this.drawActiveHandlerSlim(this.vertices[t],s[t],this.colors.handler(t,i)),this.drawSemiActiveHandlerSlim(this.vertices[f],s[f],this.colors.handler(f,i)),this.drawSemiActiveCenterHandler(r,this.colors.center(i))}else this.drawCenterHandler(r,this.colors.center(i),!1),l&&this.drawActiveHandlerSlim(this.vertices[t],s[t],this.colors.handler(t,i));this.ctx.save(),this.ctx.globalCompositeOperation="destination-over",this.drawGridSlim(i),this.ctx.restore();let be=this.canvas.transferToImageBitmap();this.imageContext.transferFromImageBitmap(be)}drawBezier(e,t,i,o,r,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.bezierCurveTo(i.x,i.y,o.x,o.y,t.x,t.y),this.ctx.strokeStyle=this.colors.curve(r),this.ctx.lineWidth=this.config.widthFactor*(s!==null?3:2),this.ctx.stroke(),this.ctx.restore()}drawGridSlim(e){let t=this.colors.grid(e),i=this.size/this.config.virtualSize,o=this.config.virtualSize/this.config.gridLines;this.ctx.save(),this.ctx.beginPath();for(let r=1;r<this.config.gridLines;r++){let s=n.value(r*o*i);this.ctx.moveTo(0,s),this.ctx.lineTo(this.size,s),this.ctx.moveTo(s,0),this.ctx.lineTo(s,this.size)}this.ctx.setLineDash([1,3]),this.ctx.strokeStyle=t.lines,this.ctx.lineWidth=n.value(this.config.widthFactor*.5),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,n.value(i*this.config.virtualSize),n.value(i*this.config.virtualSize)),this.ctx.strokeStyle=t.border,this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.stroke(),this.ctx.restore()}drawCenterHandler(e,t,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=i?t.active:t.main,this.ctx.fillRect(n.value(e.x-this.config.handlerRadius),n.value(e.y-this.config.handlerRadius),n.value(this.config.handlerRadius*2),n.value(this.config.handlerRadius*2)),this.ctx.restore()}drawSemiActiveCenterHandler(e,t){this.ctx.save(),this.ctx.shadowColor=t.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset;let i=n.value(this.config.handlerRadius*2);this.ctx.translate(e.x,e.y),this.ctx.beginPath(),this.ctx.rect(n.value(-this.config.handlerRadius),n.value(-this.config.handlerRadius),i,i),this.ctx.fillStyle=t.main,this.ctx.fill(),this.ctx.restore()}drawCenterHandlerActive(e,t){this.ctx.save(),this.ctx.shadowColor=t.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset;let i=n.value(this.config.handlerRadius*3+this.config.widthFactor*2),o=n.value(this.config.handlerRadius*3),r=n.value(this.config.handlerRadius*2);this.ctx.translate(e.x,e.y),this.ctx.beginPath(),this.ctx.rect(i/-2,i/-2,i,i),this.ctx.rect(o/-2,o/-2,o,o),this.ctx.rect(n.value(-this.config.handlerRadius),n.value(-this.config.handlerRadius),r,r),this.ctx.fillStyle=t.active,this.ctx.fill("evenodd"),this.ctx.restore()}drawHandler(e,t,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=i.common.line,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.config.handlerRadius,0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill(),this.ctx.restore()}drawActiveHandlerSlim(e,t,i){this.ctx.save(),this.ctx.shadowColor=i.common.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset,this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=n.value(this.config.widthFactor*1.5),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=i.common.activeline,this.ctx.stroke(),this.ctx.restore(),this.ctx.translate(t.x,t.y),this.ctx.beginPath(),this.ctx.arc(0,0,this.config.handlerRadius,0,Math.PI*2),this.ctx.arc(0,0,this.config.activeHandlerRadius,0,Math.PI*2,!0),this.ctx.arc(0,0,this.config.activeHandlerRadius+n.value(this.config.widthFactor*2),0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill("evenodd"),this.ctx.restore()}drawSemiActiveHandlerSlim(e,t,i){this.ctx.save(),this.ctx.shadowColor=i.common.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset,this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.strokeStyle=i.common.line,this.ctx.stroke(),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.config.handlerRadius,0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill(),this.ctx.restore()}pointFromCanvas(e){let t=this.config.virtualSize/this.size;return n.point({x:n.value(Math.max(0,Math.min(e.x,this.size))*t),y:n.value(Math.max(0,Math.min(this.size-e.y,this.size))*t)})}pointToCanvas(e){let t=this.size/this.config.virtualSize;return n.point({x:Math.max(0,Math.min(e.x,this.config.virtualSize))*t,y:this.size-Math.max(0,Math.min(e.y,this.config.virtualSize))*t})}};var x={widthFactor:1,activeHandlerRadius:10,handlerRadius:7,virtualSize:500,activeHandlerShadowBlur:7,activeHandlerShadowOffset:5,gridLines:20};var xe={light:{h1:{main:"oklch(0.355 0.146 29)"},h2:{main:"oklch(0.377 0.1 247)"},h3:{main:"oklch(0.355 0.146 29)"},h4:{main:"oklch(0.377 0.1 247)"},common:{line:"#305030",activeline:"#008000",shadow:"#202020"}},dark:{h1:{main:"oklch(0.634 0.254 18)"},h2:{main:"oklch(0.858 0.146 197)"},h3:{main:"oklch(0.634 0.254 18)"},h4:{main:"oklch(0.858 0.146 197)"},common:{line:"#E0FFE0",activeline:"#80FF80",shadow:"#202020"}}},De={light:"#303030",dark:"#D0D0D0"},ze={light:{main:"#606060",active:"#FF5000",shadow:"#404040"},dark:{main:"#A0A0A0",active:"#90F900",shadow:"#202020"}},Se={light:{lines:"#606060",border:"#101010"},dark:{lines:"#C0C0C0",border:"#F0F0F0"}},ye={handlerColors:xe,curveColor:De,gridColors:Se,centerColors:ze},O=class{colors=ye;handler(e,t){let i=t?this.colors.handlerColors.dark:this.colors.handlerColors.light;return{main:i[e].main,common:i.common}}curve(e){return e?this.colors.curveColor.dark:this.colors.curveColor.light}grid(e){return e?this.colors.gridColors.dark:this.colors.gridColors.light}center(e){return e?this.colors.centerColors.dark:this.colors.centerColors.light}};var He={colors:{start:[13,10,67],center:[218,29,11],end:[194,131,71]},center:{x:275,y:186},handlers:{h1:{x:84,y:38},h2:{x:190,y:215},h3:{x:399,y:144},h4:{x:464,y:338}},angle:144},pe={default:He};var u=class a{store=g(ie);initialState=this.store.get("double-gradient-state")??pe.default;angleDegrees=c(this.initialState.angle);startRGBColor=c(this.initialState.colors.start);centerRGBColor=c(this.initialState.colors.center);endRGBColor=c(this.initialState.colors.end);center=c(this.initialState.center);handlers=c(this.initialState.handlers);startOklch=h(()=>E(this.rgbText(this.startRGBColor())));centerOklch=h(()=>E(this.rgbText(this.centerRGBColor())));endOklch=h(()=>E(this.rgbText(this.endRGBColor())));points=h(()=>le.doublePoints(this.handlers(),this.center(),x.virtualSize));startColor=h(()=>this.oklchText(this.startOklch()));centerColor=h(()=>this.oklchText(this.centerOklch()));endColor=h(()=>this.oklchText(this.endOklch()));gradient=h(()=>he(this.startOklch(),this.centerOklch(),this.endOklch(),this.points(),this.angleDegrees()));controlGradient=h(()=>ce(this.gradient().stops,90,"oklch"));currentState=h(()=>({colors:{start:this.startRGBColor(),center:this.centerRGBColor(),end:this.endRGBColor()},center:this.center(),handlers:this.handlers(),angle:this.angleDegrees()}));constructor(){P(()=>this.store.save("double-gradient-state",this.currentState()))}onAngleDegreesChange(e){this.angleDegrees.set(e)}onStartColorChange(e){this.startRGBColor.set(e)}onCenterColorChange(e){this.centerRGBColor.set(e)}onEndColorChange(e){this.endRGBColor.set(e)}onCenterChange(e){this.center.set(e)}onHandlersChange(e){this.handlers.set(v({},e))}rgbText(e){return`rgb(${Math.round(e[0])} ${Math.round(e[1])} ${Math.round(e[2])})`}oklchText(e){return`oklch(${e[0].toFixed(3)} ${e[1].toFixed(3)} ${e[2].toFixed(1)})`}static \u0275fac=function(t){return new(t||a)};static \u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"})};var we=["canvas"],R=class a{constructor(e){this.renderer=e;P(()=>{this.dibujar(this.state.handlers(),this.state.center(),this.currentHandler(),this.darkMode())})}mouseMoveSubscription=null;moveSubscription=null;startSubscription=null;removeDocumentClickListenerFn=null;removeDocumentTouchEndListenerFn=null;state=g(u);overHandler=c(null);currentHandler=c(null);size=N(200);darkMode=N(!1);canvas;doubleBezier=null;ngAfterViewInit(){this.doubleBezier=new T(this.canvas.nativeElement.getContext("bitmaprenderer"),this.size(),new O,x),this.mouseMoveSubscription=p(this.canvas.nativeElement,"mousemove").pipe(H(()=>this.currentHandler()===null),B(5),y(e=>e)).subscribe(e=>{this.onMouseMove(e)}),this.moveSubscription=_(p(document,"mousemove"),p(document,"touchmove",{passive:!1})).pipe(H(()=>this.currentHandler()!==null),A(e=>e.preventDefault()),B(1),y(e=>e)).subscribe(e=>{this.onMoveHandler(e)}),this.startSubscription=_(p(this.canvas?.nativeElement,"mousedown").pipe(y(e=>e)),p(this.canvas?.nativeElement,"touchstart",{passive:!1}).pipe(y(e=>{let t=this.pointFromEvent(e);return this.isOverHandler(t)!==null?e:null}),H(e=>e!==null),A(e=>e.preventDefault()))).pipe(H(()=>this.currentHandler()===null),B(1)).subscribe(e=>{this.onGrabHandler(e)}),this.dibujar(this.state.handlers())}onDoubleClick(e){let t=this.overHandler();if(t===null||t==="center")return;let i={h1:1,h2:2,h3:4,h4:5},o=n.value(i[t]/6*x.virtualSize);t==="h3"||t==="h4"?this.state.onHandlersChange(D(v({},this.state.handlers()),{[t]:{x:o,y:o}})):this.state.onHandlersChange(D(v({},this.state.handlers()),{[t]:{x:o,y:o}}))}onGrabHandler(e){let t=this.pointFromEvent(e),i=this.isOverHandler(t);i!==null&&this.setHandlerSelected(i)}onMoveHandler(e){let t=this.pointFromEvent(e);this.updateHandlerCoords(t)}onMouseMove(e){let t=this.pointFromEvent(e),i=this.overHandler(),o=this.isOverHandler(t);i!==o&&this.overHandler.set(o)}stopTracking(){this.currentHandler()!==null&&(this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.currentHandler.set(null))}setHandlerSelected(e){this.setListeners(),this.currentHandler.set(e)}updateHandlerCoords(e){let t=this.currentHandler();if(t!==null){if(t==="center"){let i=e.x-this.state.center().x,o=e.y-this.state.center().y,r=this.state.handlers().h2,s=this.state.handlers().h3,l=n.point({x:r.x+i,y:r.y+o}),w=n.point({x:s.x+i,y:s.y+o});this.state.onCenterChange(n.point(e)),this.state.onHandlersChange(D(v({},this.state.handlers()),{h2:l,h3:w}));return}if(t==="h1"||t==="h4")this.state.onHandlersChange(D(v({},this.state.handlers()),{[t]:e}));else{let i=t==="h2"?"h3":"h2",o=this.doubleBezier?.oppositeHandler(this.state.center(),e,this.state.handlers()[i]);this.state.onHandlersChange(D(v({},this.state.handlers()),{[t]:{x:Math.round(e.x),y:Math.round(e.y)},[i]:{x:o.x,y:o.y}}))}}}isOverHandler(e){let t=this.state.handlers(),i=["h1","h2","h3","h4"],o=x.handlerRadius/this.size()*x.virtualSize;for(let r=1;r<=8;r++){if(I(e,this.state.center(),o*r))return"center";for(let s=0;s<i.length;s++){let l=i[s];if(I(e,t[l],o*r))return l}}return null}setListeners(){this.removeDocumentClickListenerFn=this.renderer.listen("document","mouseup",()=>this.stopTracking()),this.removeDocumentTouchEndListenerFn=this.renderer.listen("document","touchend",()=>this.stopTracking(),{passive:!0})}dibujar(e,t=this.state.center(),i=this.currentHandler(),o=this.darkMode()){if(!this.doubleBezier)return;let r=this.doubleBezier;requestAnimationFrame(()=>{r.draw(e,i,o,t)})}pointFromEvent(e){if(!this.doubleBezier)return{x:0,y:0};let t=ae.pointFromEvent(this.canvas.nativeElement,e);return this.doubleBezier.pointFromCanvas(t)}ngOnDestroy(){this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.mouseMoveSubscription?.unsubscribe(),this.moveSubscription?.unsubscribe(),this.startSubscription?.unsubscribe()}static \u0275fac=function(t){return new(t||a)(W(K))};static \u0275cmp=z({type:a,selectors:[["zz-double-bezier-panel"]],viewQuery:function(t,i){if(t&1&&U(we,5),t&2){let o;Z(o=ee())&&(i.canvas=o.first)}},inputs:{size:[1,"size"],darkMode:[1,"darkMode"]},decls:3,vars:10,consts:[["canvas",""],["id","canvas",1,"rounded-lg",3,"dblclick","width","height"]],template:function(t,i){if(t&1){let o=$();X(0,"div")(1,"canvas",1,0),J("dblclick",function(s){return j(o),q(i.onDoubleClick(s))}),Y()()}t&2&&(d(),k("padding",i.size()/20,"px")("background",i.state.controlGradient()),G("cursor-grab",i.overHandler()!==null)("cursor-grabbing",i.currentHandler()!==null),Q("width",i.size())("height",i.size()))},encapsulation:2,changeDetection:0})};var F=class a{state=g(u);onColorEndChange(e){this.state.onEndColorChange(e)}onColorCenterChange(e){this.state.onCenterColorChange(e)}onColorStartChange(e){this.state.onStartColorChange(e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=z({type:a,selectors:[["zz-double-gradient-colors"]],hostAttrs:[1,"w-full"],decls:4,vars:6,consts:[[1,"flex","flex-row","items-center","justify-center","gap-2","w-full"],[1,"shadow-md",3,"color-changing","border","color"]],template:function(t,i){t&1&&(m(0,"div",0)(1,"zz-color-selector",1),M("color-changing",function(r){return i.onColorStartChange(r)}),C(),m(2,"zz-color-selector",1),M("color-changing",function(r){return i.onColorCenterChange(r)}),C(),m(3,"zz-color-selector",1),M("color-changing",function(r){return i.onColorEndChange(r)}),C()()),t&2&&(d(),b("border","border-current/40")("color",i.state.startRGBColor()),d(),b("border","border-current/40")("color",i.state.centerRGBColor()),d(),b("border","border-current/40")("color",i.state.endRGBColor()))},dependencies:[re],encapsulation:2,changeDetection:0})};var fe=class a{state=g(u);bezierSize=280;compassSize=130;ngAfterViewInit(){p(document,"touchstart",{passive:!0}).subscribe(()=>{this.requestFullscreen()})}requestFullscreen(){document.fullscreenElement||document.documentElement.requestFullscreen().catch(()=>{console.info("Error attempting to enable full-screen mode")})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=z({type:a,selectors:[["zz-double-bezier-gradient"]],features:[te([{provide:de,useExisting:u},{provide:ue,useExisting:u}])],decls:12,vars:10,consts:[[1,"bg-application","w-screen","h-screen","overflow-hidden"],[1,"sticky","bg-application","z-20","top-0","left-0","right-0","shadow-md","dark:shadow-black/60"],[1,"w-screen","min-h-[calc(100vh_-_50px)]","grid","justify-center","place-content-start","auto-rows-auto","gap-4","px-4","pt-[10svh]","pb-8"],[3,"size","darkMode"],[1,"flex","items-center","gap-4","justify-center"],[1,"-ml-1","mt-2",3,"size","darkMode"],[1,"flex","flex-col","items-center","gap-4","pr-1"]],template:function(t,i){t&1&&(m(0,"div",0)(1,"div",1),S(2,"zz-header"),C(),m(3,"main",2)(4,"div"),S(5,"zz-double-bezier-panel",3),m(6,"div",4),S(7,"zz-orientation-compass",5),m(8,"div",6),S(9,"zz-double-gradient-colors")(10,"zz-gradient-actions"),C()()()()(),S(11,"zz-notification")),t&2&&(d(3),k("background",i.state.gradient().gradient),G("text-gris-900",!i.state.gradient().darkMode)("text-gris-100",i.state.gradient().darkMode),d(2),b("size",i.bezierSize)("darkMode",i.state.gradient().darkMode),d(2),b("size",i.compassSize)("darkMode",i.state.gradient().darkMode))},dependencies:[ne,oe,R,me,ve,F,se],encapsulation:2,changeDetection:0})};export{fe as DoubleBezierGradientComponent};
