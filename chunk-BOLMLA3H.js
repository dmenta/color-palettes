import{a as te,b as y,c as ie,d as n,e as oe,f as re,h as ne,i as se,k as ae,l as le,m as he}from"./chunk-EAACDQTF.js";import{a as U,f as E,n as ee}from"./chunk-AG74TOS6.js";import{$a as K,Ca as k,L as V,La as H,Ma as B,Na as M,O as j,T as g,Ua as m,Va as S,Wa as C,Xa as $,Z as A,Za as Q,_ as N,a as u,ab as X,b as x,bb as Y,bc as Z,ha as _,ja as l,kb as J,p as D,ta as f,u as c,v as L,vb as h,w as z,wa as q,wb as P,xa as W,z as w}from"./chunk-MLHRJ3PS.js";var G=class{constructor(e,t,i,o){this.imageContext=e;this.size=t;this.colors=i;this.config=o;this.canvas=new OffscreenCanvas(t,t);let r=this.canvas.getContext("2d");r.imageSmoothingQuality="high",r.imageSmoothingEnabled=!0,this.ctx=r,this.start=n.point({x:0,y:this.size}),this.end=n.point({x:this.size,y:0}),this.vertices={h1:this.start,h2:this.start,h3:this.end,h4:this.end}}ctx;start;end;vertices;canvas;handlersToCanvas(e){return{h1:this.pointToCanvas(e.h1),h2:this.pointToCanvas(e.h2),h3:this.pointToCanvas(e.h3),h4:this.pointToCanvas(e.h4)}}oppositeHandler(e,t,i){let o=e.y-t.y,r=e.x-t.x;o=Math.abs(o)<.25?Math.sign(o)*.25:o,r=Math.abs(r)<.25?Math.sign(r)*.25:r;let s=Math.sqrt(Math.pow(r,2)+Math.pow(o,2)),d=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return n.point({x:e.x+r/s*d,y:e.y+o/s*d})}draw(e,t,i,o){let r=this.pointToCanvas(o);this.vertices.h2=r,this.vertices.h3=r;let s=this.handlersToCanvas(e);this.drawGrid(i);let d=t==="h2"?"h3":t==="h3"?"h2":null,v=t==="h1"?"h1":"h2",R=v==="h1"?"h2":"h1";this.drawHandler(this.vertices[R],s[R],this.colors.handler(R,i),!1),this.drawHandler(this.vertices[v],s[v],this.colors.handler(v,i),t===v,d===v);let b=t==="h4"?"h4":"h3",I=b==="h4"?"h3":"h4";this.drawHandler(this.vertices[I],s[I],this.colors.handler(I,i),!1),this.drawHandler(this.vertices[b],s[b],this.colors.handler(b,i),t===b,d===b),this.drawBezier(this.start,r,s.h1,s.h2,i,t!==null),this.drawBezier(r,this.end,s.h3,s.h4,i,t!==null);let ue=this.canvas.transferToImageBitmap();this.imageContext.transferFromImageBitmap(ue)}drawBezier(e,t,i,o,r,s){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.strokeStyle=this.colors.curve(r),this.ctx.bezierCurveTo(i.x,i.y,o.x,o.y,t.x,t.y),this.ctx.lineWidth=this.config.widthFactor*(s!==null?3:2),this.ctx.stroke()}drawGrid(e){let t=this.colors.grid(e),i=this.size/this.config.virtualSize;this.ctx.beginPath(),this.ctx.rect(0,0,n.value(i*this.config.virtualSize),n.value(i*this.config.virtualSize)),this.ctx.strokeStyle=t.border,this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.stroke(),this.ctx.strokeStyle=t.lines,this.ctx.setLineDash([1,3]);for(let o=10;o<this.config.virtualSize;o+=this.config.virtualSize/this.config.gridLines)this.ctx.beginPath(),this.ctx.moveTo(0,n.value(o*i)),this.ctx.lineTo(this.size,n.value(o*i)),this.ctx.lineWidth=n.value(this.config.widthFactor*.5),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(n.value(o*i),0),this.ctx.lineTo(n.value(o*i),this.size),this.ctx.lineWidth=n.value(this.config.widthFactor*.5),this.ctx.stroke();this.ctx.setLineDash([])}drawHandler(e,t,i,o,r=!1){(o||r)&&(this.ctx.shadowColor=i.common.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset,o&&this.drawHandlerActive(t,i)),this.drawHandlerLine(e,t,i,o),r||(this.ctx.shadowColor="transparent"),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.config.handlerRadius,0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill(),this.ctx.shadowColor="transparent"}drawHandlerActive(e,t){this.ctx.beginPath(),this.ctx.arc(e.x,e.y,this.config.activeHandlerRadius,0,Math.PI*2),this.ctx.strokeStyle=t.main,this.ctx.lineWidth=n.value(this.config.widthFactor*2),this.ctx.stroke()}drawHandlerLine(e,t,i,o){this.ctx.beginPath(),this.ctx.lineWidth=n.value(this.config.widthFactor*(o?1.5:1)),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=o?i.common.activeline:i.common.line,this.ctx.stroke()}pointFromCanvas(e){let t=this.config.virtualSize/this.size;return n.point({x:n.value(Math.max(0,Math.min(e.x,this.size))*t),y:n.value(Math.max(0,Math.min(this.size-e.y,this.size))*t)})}pointToCanvas(e){let t=this.size/this.config.virtualSize;return n.point({x:Math.max(0,Math.min(e.x,this.config.virtualSize))*t,y:this.size-Math.max(0,Math.min(e.y,this.config.virtualSize))*t})}};var p={widthFactor:1,activeHandlerRadius:10,handlerRadius:7,virtualSize:2e3,activeHandlerShadowBlur:7,activeHandlerShadowOffset:5,gridLines:20};var me={light:{h1:{main:"oklch(0.355 0.146 29)"},h2:{main:"oklch(0.377 0.1 247)"},h3:{main:"oklch(0.355 0.146 29)"},h4:{main:"oklch(0.377 0.1 247)"},common:{line:"#305030",activeline:"#008000",shadow:"#202020"}},dark:{h1:{main:"oklch(0.634 0.254 18)"},h2:{main:"oklch(0.858 0.146 197)"},h3:{main:"oklch(0.634 0.254 18)"},h4:{main:"oklch(0.858 0.146 197)"},common:{line:"#E0FFE0",activeline:"#80FF80",shadow:"#202020"}}},pe={light:"#303030",dark:"#D0D0D0"},ve={light:{lines:"#606060",border:"#101010"},dark:{lines:"#C0C0C0",border:"#F0F0F0"}},be={handlerColors:me,curveColor:pe,gridColors:ve},T=class{colors=be;handler(e,t){let i=t?this.colors.handlerColors.dark:this.colors.handlerColors.light;return{main:i[e].main,common:i.common}}curve(e){return e?this.colors.curveColor.dark:this.colors.curveColor.light}grid(e){return e?this.colors.gridColors.dark:this.colors.gridColors.light}};var fe=["canvas"],F=class a{constructor(e){this.renderer=e;P(()=>{this.dibujar(this.state.handlers(),this.currentHandler(),this.darkMode())})}mouseMoveSubscription=null;moveSubscription=null;startSubscription=null;removeDocumentClickListenerFn=null;removeDocumentTouchEndListenerFn=null;state=g(y);overHandler=l(null);currentHandler=l(null);size=_(200);darkMode=_(!1);canvas;doubleBezier=null;ngAfterViewInit(){this.doubleBezier=new G(this.canvas.nativeElement.getContext("bitmaprenderer"),this.size(),new T,p),this.mouseMoveSubscription=c(this.canvas.nativeElement,"mousemove").pipe(z(()=>this.currentHandler()===null),w(5),D(e=>e)).subscribe(e=>{this.onMouseMove(e)}),this.moveSubscription=L(c(document,"mousemove"),c(document,"touchmove",{passive:!1})).pipe(z(()=>this.currentHandler()!==null),V(e=>e.preventDefault()),w(1),D(e=>e)).subscribe(e=>{this.onMoveHandler(e)}),this.startSubscription=L(c(this.canvas?.nativeElement,"mousedown").pipe(D(e=>e)),c(this.canvas?.nativeElement,"touchstart",{passive:!1}).pipe(D(e=>{let t=this.pointFromEvent(e);return this.isOverHandler(t)!==null?e:null}),z(e=>e!==null),V(e=>e.preventDefault()))).pipe(z(()=>this.currentHandler()===null),w(1)).subscribe(e=>{this.onGrabHandler(e)}),this.canvas.nativeElement.oncontextlost=e=>{console.warn("Context lost",e)},this.dibujar(this.state.handlers())}onDoubleClick(e){let t=this.overHandler();if(t===null)return;let i={h1:1,h2:2,h3:4,h4:5},o=n.value(i[t]/6*p.virtualSize);t==="h3"||t==="h4"?this.state.onHandlersChange(x(u({},this.state.handlers()),{[t]:{x:o,y:o}})):this.state.onHandlersChange(x(u({},this.state.handlers()),{[t]:{x:o,y:o}}))}onGrabHandler(e){let t=this.pointFromEvent(e),i=this.isOverHandler(t);i!==null&&this.setHandlerSelected(i)}onMoveHandler(e){let t=this.pointFromEvent(e);this.updateHandlerCoords(t)}onMouseMove(e){let t=this.pointFromEvent(e),i=this.overHandler(),o=this.isOverHandler(t);i!==o&&this.overHandler.set(o)}stopTracking(){this.currentHandler()!==null&&(this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.currentHandler.set(null))}setHandlerSelected(e){this.setListeners(),this.currentHandler.set(e)}updateHandlerCoords(e){let t=this.currentHandler();if(t!==null)if(t==="h1"||t==="h4")this.state.onHandlersChange(x(u({},this.state.handlers()),{[t]:e}));else{let i=t==="h2"?"h3":"h2",o=this.doubleBezier?.oppositeHandler(this.state.center(),e,this.state.handlers()[i]);this.state.onHandlersChange(x(u({},this.state.handlers()),{[t]:{x:Math.round(e.x),y:Math.round(e.y)},[i]:{x:o.x,y:o.y}}))}}isOverHandler(e){let t=this.state.handlers(),i=["h1","h2","h3","h4"],o=p.handlerRadius/this.size()*p.virtualSize;for(let r=1;r<=8;r++)for(let s=0;s<i.length;s++){let d=i[s];if(re(e,t[d],o*r))return d}return null}setListeners(){this.removeDocumentClickListenerFn=this.renderer.listen("document","mouseup",()=>this.stopTracking()),this.removeDocumentTouchEndListenerFn=this.renderer.listen("document","touchend",()=>this.stopTracking(),{passive:!0})}dibujar(e,t=this.currentHandler(),i=this.darkMode()){if(!this.doubleBezier)return;let o=this.doubleBezier;requestAnimationFrame(()=>{o.draw(e,t,i,this.state.center())})}pointFromEvent(e){if(!this.doubleBezier)return{x:0,y:0};let t=oe.pointFromEvent(this.canvas.nativeElement,e);return this.doubleBezier.pointFromCanvas(t)}ngOnDestroy(){this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.mouseMoveSubscription?.unsubscribe(),this.moveSubscription?.unsubscribe(),this.startSubscription?.unsubscribe()}static \u0275fac=function(t){return new(t||a)(W(q))};static \u0275cmp=k({type:a,selectors:[["zz-double-bezier-panel"]],viewQuery:function(t,i){if(t&1&&K(fe,5),t&2){let o;X(o=Y())&&(i.canvas=o.first)}},inputs:{size:[1,"size"],darkMode:[1,"darkMode"]},decls:3,vars:8,consts:[["canvas",""],["id","canvas",1,"bg-gris-500/20","rounded-lg",3,"dblclick","width","height"]],template:function(t,i){if(t&1){let o=$();m(0,"div")(1,"canvas",1,0),Q("dblclick",function(s){return A(o),N(i.onDoubleClick(s))}),S()()}t&2&&(f(),B("padding",i.size()/20,"px"),M("cursor-grab",i.overHandler()!==null)("cursor-grabbing",i.currentHandler()!==null),H("width",i.size())("height",i.size()))},encapsulation:2,changeDetection:0})};var O=class a{store=g(U);initialState=this.store.get("double-gradient-state")??ae;angleDegrees=l(this.initialState.angle);startRGBColor=l(this.initialState.colors.start);centerRGBColor=l(this.initialState.colors.center);endRGBColor=l(this.initialState.colors.end);center=l(this.initialState.center);handlers=l(this.initialState.handlers);startOklch=h(()=>E(this.rgbText(this.startRGBColor())));centerOklch=h(()=>E(this.rgbText(this.centerRGBColor())));endOklch=h(()=>E(this.rgbText(this.endRGBColor())));points=h(()=>le.doublePoints(this.handlers(),this.center(),p.virtualSize));startColor=h(()=>this.oklchText(this.startOklch()));endColor=h(()=>this.oklchText(this.endOklch()));gradient=h(()=>ne(this.startOklch(),this.centerOklch(),this.endOklch(),this.points(),this.angleDegrees()));currentState=h(()=>({colors:{start:this.startRGBColor(),center:this.centerRGBColor(),end:this.endRGBColor()},center:this.center(),handlers:this.handlers(),angle:this.angleDegrees()}));constructor(){P(()=>this.store.save("double-gradient-state",this.currentState()))}onAngleDegreesChange(e){this.angleDegrees.set(e)}onStartColorChange(e){this.startRGBColor.set(e)}onCenterColorChange(e){this.centerRGBColor.set(e)}onEndColorChange(e){this.endRGBColor.set(e)}onCenterChange(e){this.center.set(e)}onHandlersChange(e){this.handlers.set(u({},e))}rgbText(e){return`rgb(${Math.round(e[0])} ${Math.round(e[1])} ${Math.round(e[2])})`}oklchText(e){return`oklch(${e[0].toFixed(3)} ${e[1].toFixed(3)} ${e[2].toFixed(1)})`}static \u0275fac=function(t){return new(t||a)};static \u0275prov=j({token:a,factory:a.\u0275fac,providedIn:"root"})};var ce=class a{state=g(y);bezierSize=280;compassSize=130;ngOnInit(){c(document,"touchstart",{passive:!0}).subscribe(()=>{this.requestFullscreen()})}requestFullscreen(){document.fullscreenElement||document.documentElement.requestFullscreen().catch(()=>{console.debug("Error attempting to enable full-screen mode")})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=k({type:a,selectors:[["zz-double-bezier-gradient"]],features:[J([{provide:y,useExisting:O}])],decls:12,vars:10,consts:[[1,"bg-application","w-screen","h-screen","overflow-hidden"],[1,"sticky","bg-application","z-20","top-0","left-0","right-0","shadow-md","dark:shadow-black/60"],[1,"w-screen","min-h-[calc(100vh_-_50px)]","grid","justify-center","place-content-start","auto-rows-auto","gap-4","px-4","pt-[10svh]","pb-8"],[3,"size","darkMode"],[1,"flex","items-center","gap-4","justify-center"],[1,"-ml-1",3,"size","darkMode"],[1,"flex","flex-col","items-center","gap-4","pr-1"]],template:function(t,i){t&1&&(m(0,"div",0)(1,"div",1),C(2,"zz-gradients-header"),S(),m(3,"main",2)(4,"div"),C(5,"zz-double-bezier-panel",3),m(6,"div",4),C(7,"zz-orientation-compass",5),m(8,"div",6),C(9,"zz-gradient-colors")(10,"zz-gradient-actions"),S()()()()(),C(11,"zz-notification")),t&2&&(f(3),B("background",i.state.gradient().gradient),M("text-gris-900",!i.state.gradient().darkMode)("text-gris-100",i.state.gradient().darkMode),f(2),H("size",i.bezierSize)("darkMode",i.state.gradient().darkMode),f(2),H("size",i.compassSize)("darkMode",i.state.gradient().darkMode))},dependencies:[ee,te,Z,ie,F,se,he],encapsulation:2,changeDetection:0})};export{ce as DoubleBezierGradientComponent};
