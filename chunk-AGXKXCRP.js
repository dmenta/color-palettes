import{a as s,b as le,c as de,d as ce,f as he,g as R,h as me,i as ue,j as pe,k as ve}from"./chunk-LH6BPALC.js";import{c as O,j as oe,k as se,l as ae}from"./chunk-7EATYIG4.js";import{$ as te,A as f,Ga as ie,L as b,M as d,N as C,O as g,P as W,Q as Y,S as Z,T as X,U as y,V as J,Z as U,_ as ee,_a as ne,a as x,b as P,ba as w,ca as M,d as S,e as u,f as T,g as z,h as H,k as F,la as re,m as V,o as p,p as L,q as j,r as A,s as q,t as v,ta as m,ua as D,w as $,wa as _,x as h,y as Q,z as K}from"./chunk-YQLJXUXD.js";var a=2e3,k=class{constructor(e,t,r){this.imageContext=e;this.size=t;this.colors=r;this.canvas=new OffscreenCanvas(t,t);let i=this.canvas.getContext("2d");i.imageSmoothingQuality="high",i.imageSmoothingEnabled=!0,this.ctx=i,this.start=s.point({x:0,y:this.size}),this.end=s.point({x:this.size,y:0}),this.vertices={h1:this.start,h2:this.end}}handlerRadius=10;widthFactor=1;activeHandlerRadius=18;activeHandlerShadowBlur=7;activeHandlerShadowOffset=5;gridLines=10;ctx;start;end;canvas;vertices;draw(e,t,r){this.drawBezierPanel(e,t,r);let i=this.canvas.transferToImageBitmap();this.imageContext.transferFromImageBitmap(i)}drawBezierPanel(e,t,r){this.ctx.save(),this.ctx.globalCompositeOperation="destination-over";for(let i of["h1","h2"])i!==t&&this.drawHandler(e[i],i,r);this.ctx.restore(),this.ctx.save(),t===null&&(this.ctx.globalCompositeOperation="destination-over"),this.drawBezierCurve(e,t!==null,r),this.ctx.restore(),t!==null&&this.drawActiveHandlerSlim(e[t],t,r),this.ctx.save(),this.ctx.globalCompositeOperation="destination-over",this.drawGrid(r),this.ctx.restore()}drawBezierCurve(e,t,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.start.x,this.start.y),this.ctx.strokeStyle=this.colors.curve(r),this.ctx.bezierCurveTo(e.h1.x,e.h1.y,e.h2.x,e.h2.y,this.end.x,this.end.y),this.ctx.lineWidth=this.widthFactor*(t!==null?3:2),this.ctx.stroke(),this.ctx.restore()}drawGrid(e){let t=this.colors.grid(e),r=this.size/a,i=a/this.gridLines;this.ctx.save(),this.ctx.beginPath();for(let o=1;o<this.gridLines;o++){let l=s.value(o*i*r);this.ctx.moveTo(0,l),this.ctx.lineTo(this.size,l),this.ctx.moveTo(l,0),this.ctx.lineTo(l,this.size)}this.ctx.setLineDash([1,3]),this.ctx.strokeStyle=t.lines,this.ctx.lineWidth=s.value(this.widthFactor*.5),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,s.value(r*a),s.value(r*a)),this.ctx.strokeStyle=t.border,this.ctx.lineWidth=s.value(this.widthFactor*1),this.ctx.stroke(),this.ctx.restore()}drawHandler(e,t,r){let i=this.colors.handler(t,r);this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,this.handlerRadius,0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill(),this.ctx.restore(),this.ctx.save();let o=Math.atan2(e.y-this.vertices[t].y,e.x-this.vertices[t].x)+Math.PI/2,l=Math.sqrt(Math.pow(e.x-this.vertices[t].x,2)+Math.pow(e.y-this.vertices[t].y,2));this.ctx.translate(e.x,e.y),this.ctx.rotate(o),this.ctx.beginPath(),this.ctx.rect(-.75,0,1.5,l),this.ctx.fillStyle=i.common.line,this.ctx.fill(),this.ctx.restore()}drawActiveHandlerSlim(e,t,r){let i=this.colors.handler(t,r);this.ctx.save(),this.ctx.shadowColor=i.common.shadow,this.ctx.shadowBlur=this.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.activeHandlerShadowOffset,this.ctx.save();let o=Math.atan2(e.y-this.vertices[t].y,e.x-this.vertices[t].x)+Math.PI/2,l=Math.sqrt(Math.pow(e.x-this.vertices[t].x,2)+Math.pow(e.y-this.vertices[t].y,2));this.ctx.translate(e.x,e.y),this.ctx.rotate(o),this.ctx.beginPath(),this.ctx.rect(-1,0,2,l),this.ctx.fillStyle=i.common.activeline,this.ctx.fill(),this.ctx.restore(),this.ctx.translate(e.x,e.y),this.ctx.beginPath(),this.ctx.arc(0,0,this.handlerRadius,0,Math.PI*2),this.ctx.arc(0,0,this.activeHandlerRadius,0,Math.PI*2,!0),this.ctx.arc(0,0,this.activeHandlerRadius-s.value(this.widthFactor*2),0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill("evenodd"),this.ctx.restore()}};function ge(n,e){let t=a/e;return s.point({x:s.value(Math.max(0,Math.min(n.x,e))*t),y:s.value(Math.max(0,Math.min(e-n.y,e))*t)})}function N(n,e){let t=e/a;return s.point({x:Math.max(0,Math.min(n.x,a))*t,y:e-Math.max(0,Math.min(n.y,a))*t})}var Ce={colors:{start:[249,147,52],end:[7,10,95]},handlers:{h1:{x:286,y:972},h2:{x:736,y:1515}},angle:0};var c=class n{store=p(ie);initialState=this.store.get("gradient-state")??Ce;angleDegrees=v(this.initialState.angle);startRGBColor=v(this.initialState.colors.start);endRGBColor=v(this.initialState.colors.end);handlers=v(this.initialState.handlers);startOklch=m(()=>O(this.rgbText(this.startRGBColor())));endOklch=m(()=>O(this.rgbText(this.endRGBColor())));points=m(()=>de.points(this.handlers(),a,a));startColor=m(()=>this.oklchText(this.startOklch()));endColor=m(()=>this.oklchText(this.endOklch()));gradient=m(()=>ce(this.startOklch(),this.endOklch(),this.points(),this.angleDegrees()));controlGradient=m(()=>he(this.gradient().stops,90,"oklch"));currentState=m(()=>({colors:{start:this.startRGBColor(),end:this.endRGBColor()},handlers:this.handlers(),angle:this.angleDegrees()}));constructor(){D(()=>this.store.save("gradient-state",this.currentState()))}onAngleDegreesChange(e){this.angleDegrees.set(e)}onStartColorChange(e){this.startRGBColor.set(e)}onEndColorChange(e){this.endRGBColor.set(e)}onHandlersChange(e){this.handlers.set(x({},e))}rgbText(e){return`rgb(${Math.round(e[0])} ${Math.round(e[1])} ${Math.round(e[2])})`}oklchText(e){return`oklch(${e[0].toFixed(3)} ${e[1].toFixed(3)} ${e[2].toFixed(1)})`}static \u0275fac=function(t){return new(t||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var E=class n{state=p(c);handleSwapShortcut(e){e.preventDefault(),this.swap()}swap(){let e=this.state.startRGBColor(),t=this.state.endRGBColor();this.state.onStartColorChange(t),this.state.onEndColorChange(e)}onColorEndChange(e){this.state.onEndColorChange(e)}onColorStartChange(e){this.state.onStartColorChange(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=f({type:n,selectors:[["zz-gradient-colors"]],hostAttrs:[1,"w-full"],hostBindings:function(t,r){t&1&&y("keydown.control.shift.y",function(o){return r.handleSwapShortcut(o)},$)},decls:6,vars:4,consts:[[1,"flex","flex-row","items-center","justify-between","gap-2","w-full"],[1,"shadow-md",3,"color-changing","border","color"],["title","Swap colors (Ctrl+Shift+Y)",1,"shadow-md",3,"click"],["viewBox","0 -960 960 960","fill","currentColor",1,"w-6","h-6","-mt-1"],["d","M280-160 80-360l200-200 56 57-103 103h287v80H233l103 103-56 57Zm400-240-56-57 103-103H440v-80h287L624-743l56-57 200 200-200 200Z"]],template:function(t,r){t&1&&(d(0,"div",0)(1,"zz-color-selector",1),y("color-changing",function(o){return r.onColorStartChange(o)}),C(),d(2,"button",2),y("click",function(){return r.swap()}),A(),d(3,"svg",3),g(4,"path",4),C()(),q(),d(5,"zz-color-selector",1),y("color-changing",function(o){return r.onColorEndChange(o)}),C()()),t&2&&(h(),b("border","border-current/40")("color",r.state.startRGBColor()),h(4),b("border","border-current/40")("color",r.state.endRGBColor()))},dependencies:[oe],encapsulation:2,changeDetection:0})};var xe={light:{h1:"oklch(0.355 0.146 29)",h2:"oklch(0.377 0.1 247)",common:{line:"#305030",activeline:"#008000",shadow:"#202020"}},dark:{h1:"oklch(0.634 0.254 18)",h2:"oklch(0.858 0.146 197)",common:{line:"#d0d0d0",activeline:"#80FF80",shadow:"#000000"}}},Se={light:"#303030",dark:"#D0D0D0"},ze={light:{lines:"#606060",border:"#101010"},dark:{lines:"#C0C0C0",border:"#F0F0F0"}},ye={handlerColors:xe,curveColor:Se,gridColors:ze},G=class{colors=ye;handler(e,t){let r=t?this.colors.handlerColors.dark:this.colors.handlerColors.light;return{main:r[e],common:r.common}}curve(e){return e?this.colors.curveColor.dark:this.colors.curveColor.light}grid(e){return e?this.colors.gridColors.dark:this.colors.gridColors.light}};var He=["canvas"],B=class n{constructor(e){this.renderer=e;D(()=>{let t=this.handlersToCanvas(this.state.handlers());this.dibujar(t,this.currentHandler(),this.size(),this.darkMode())})}mouseMoveSubscription=null;moveSubscription=null;startSubscription=null;removeDocumentClickListenerFn=null;removeDocumentTouchEndListenerFn=null;state=p(c);overHandler=v(null);currentHandler=v(null);size=_(200);darkMode=_(!1);canvas;bezierDrawing=null;canvasRealSize=0;ngAfterViewInit(){this.bezierDrawing=new k(this.canvas.nativeElement.getContext("bitmaprenderer"),this.size(),new G),this.mouseMoveSubscription=u(this.canvas.nativeElement,"mousemove").pipe(z(()=>this.currentHandler()===null),H(5),S(e=>e)).subscribe(e=>{this.onMouseMove(e)}),this.moveSubscription=T(u(document,"mousemove"),u(document,"touchmove",{passive:!1})).pipe(z(()=>this.currentHandler()!==null),F(e=>e.preventDefault()),H(1),S(e=>e)).subscribe(e=>{this.onMoveHandler(e)}),this.startSubscription=T(u(this.canvas?.nativeElement,"mousedown").pipe(S(e=>e)),u(this.canvas?.nativeElement,"touchstart",{passive:!1}).pipe(S(e=>{let t=this.pointFromEvent(e);return this.isOverHandler(t)!==null?e:null}),z(e=>e!==null),F(e=>e.preventDefault()))).pipe(z(()=>this.currentHandler()===null),H(1)).subscribe(e=>{this.onGrabHandler(e)}),this.canvasRealSize=this.realSize(),this.dibujar(this.handlersToCanvas(this.state.handlers()))}onDoubleClick(e){let t=this.overHandler();if(t===null)return;let r=s.value((t==="h1"?1:2)/3*a);this.state.onHandlersChange(P(x({},this.state.handlers()),{[t]:{x:r,y:r}}))}onGrabHandler(e){let t=this.pointFromEvent(e),r=this.isOverHandler(t);r!==null&&this.setHandlerSelected(r)}onMoveHandler(e){let t=this.pointFromEvent(e);this.updateHandlerCoords(t)}onMouseMove(e){let t=this.pointFromEvent(e),r=this.overHandler(),i=this.isOverHandler(t);r!==i&&this.overHandler.set(i)}stopTracking(){this.currentHandler()!==null&&(this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.currentHandler.set(null))}setHandlerSelected(e){this.setListeners(),this.currentHandler.set(e)}updateHandlerCoords(e){let t=this.currentHandler();t!==null&&this.state.onHandlersChange(P(x({},this.state.handlers()),{[t]:e}))}isOverHandler(e){let t=this.state.handlers(),r=this.bezierDrawing.handlerRadius/this.size()*a;for(let i=1;i<=8;i++){if(R(e,t.h1,r*i))return"h1";if(R(e,t.h2,r*i))return"h2"}return null}setListeners(){this.removeDocumentClickListenerFn=this.renderer.listen("document","mouseup",()=>this.stopTracking()),this.removeDocumentTouchEndListenerFn=this.renderer.listen("document","touchend",()=>this.stopTracking(),{passive:!0})}dibujar(e,t=this.currentHandler(),r=this.size(),i=this.darkMode()){if(this.bezierDrawing===null)return;let o=this.bezierDrawing;requestAnimationFrame(()=>{o.draw(e,t,i)})}handlersToCanvas(e){return{h1:N(e.h1,this.size()),h2:N(e.h2,this.size())}}pointFromEvent(e){let t=le.pointFromEvent(this.canvas.nativeElement,e);return ge(t,this.canvasRealSize)}realSize(){let e=this.canvas?.nativeElement,t=window.getComputedStyle(e),i=2*(parseFloat(t.paddingBottom.replace("px",""))||0),o=e.getBoundingClientRect();return o.bottom-o.top-i}ngOnDestroy(){this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.mouseMoveSubscription?.unsubscribe(),this.moveSubscription?.unsubscribe(),this.startSubscription?.unsubscribe()}static \u0275fac=function(t){return new(t||n)(K(Q))};static \u0275cmp=f({type:n,selectors:[["zz-bezier-panel"]],viewQuery:function(t,r){if(t&1&&U(He,5),t&2){let i;ee(i=te())&&(r.canvas=i.first)}},inputs:{size:[1,"size"],darkMode:[1,"darkMode"]},decls:3,vars:10,consts:[["canvas",""],["id","canvas",1,"rounded-lg",3,"dblclick","width","height"]],template:function(t,r){if(t&1){let i=Z();W(0,"div")(1,"canvas",1,0),J("dblclick",function(l){return L(i),j(r.onDoubleClick(l))}),Y()()}t&2&&(h(),w("padding",r.size()/20,"px")("background",r.state.controlGradient()),M("cursor-grab",r.overHandler()!==null)("cursor-grabbing",r.currentHandler()!==null),X("width",r.size())("height",r.size()))},encapsulation:2,changeDetection:0})};var be=class n{state=p(c);bezierSize=280;compassSize=130;ngAfterViewInit(){u(document,"touchstart",{passive:!0}).subscribe(()=>{this.requestFullscreen()})}requestFullscreen(){document.fullscreenElement||document.documentElement.requestFullscreen().catch(()=>{console.info("Error attempting to enable full-screen mode")})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=f({type:n,selectors:[["zz-test-col"]],features:[re([{provide:ue,useExisting:c},{provide:me,useExisting:c}])],decls:12,vars:10,consts:[[1,"bg-application","w-screen","h-screen","overflow-hidden"],[1,"sticky","bg-application","z-20","top-0","left-0","right-0","shadow-md","dark:shadow-black/60"],[1,"w-screen","min-h-[calc(100vh_-_50px)]","grid","justify-center","place-content-start","auto-rows-auto","gap-4","px-4","pt-[10svh]","pb-8"],[3,"size","darkMode"],[1,"flex","items-center","gap-4","justify-center"],[1,"-ml-1","mt-4",3,"size","darkMode"],[1,"flex","flex-col","items-center","gap-4","pr-1"]],template:function(t,r){t&1&&(d(0,"div",0)(1,"div",1),g(2,"zz-header"),C(),d(3,"main",2)(4,"div"),g(5,"zz-bezier-panel",3),d(6,"div",4),g(7,"zz-orientation-compass",5),d(8,"div",6),g(9,"zz-gradient-colors")(10,"zz-gradient-actions"),C()()()()(),g(11,"zz-notification")),t&2&&(h(3),w("background",r.state.gradient().gradient),M("text-gris-900",!r.state.gradient().darkMode)("text-gris-100",r.state.gradient().darkMode),h(2),b("size",r.bezierSize)("darkMode",r.state.gradient().darkMode),h(2),b("size",r.compassSize)("darkMode",r.state.gradient().darkMode))},dependencies:[se,ne,E,B,pe,ve,ae],encapsulation:2,changeDetection:0})};export{be as BezierGradientComponent};
