import{a as oe,b as C,c as n,d as re,e as j,g as ne,h as se,j as ae,k as le,l as he}from"./chunk-P5BPO6KK.js";import{a as Z,f as E,m as te,n as ie}from"./chunk-AG74TOS6.js";import{$a as X,Ca as z,L as I,La as m,Ma as k,Na as P,O as N,T as f,Ua as h,Va as p,Wa as D,Xa as Q,Z as q,Za as S,_ as K,a as v,ab as Y,b as x,bb as J,bc as ee,ha as V,ja as c,kb as U,p as H,ta as d,u as g,v as A,vb as u,w,wa as W,wb as T,xa as $,z as B}from"./chunk-MLHRJ3PS.js";var G=class{constructor(e,t,i,o){this.imageContext=e;this.size=t;this.colors=i;this.config=o;this.canvas=new OffscreenCanvas(t,t);let r=this.canvas.getContext("2d");r.imageSmoothingQuality="high",r.imageSmoothingEnabled=!0,this.ctx=r,this.start=n.point({x:0,y:this.size}),this.end=n.point({x:this.size,y:0}),this.vertices={h1:this.start,h2:this.start,h3:this.end,h4:this.end}}handlersKeys=["h4","h3","h2","h1"];ctx;start;end;vertices;canvas;handlersToCanvas(e){return{h1:this.pointToCanvas(e.h1),h2:this.pointToCanvas(e.h2),h3:this.pointToCanvas(e.h3),h4:this.pointToCanvas(e.h4)}}oppositeHandler(e,t,i){let o=e.y-t.y,r=e.x-t.x;o=Math.abs(o)<.25?Math.sign(o)*.25:o,r=Math.abs(r)<.25?Math.sign(r)*.25:r;let s=Math.sqrt(Math.pow(r,2)+Math.pow(o,2)),l=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return n.point({x:e.x+r/s*l,y:e.y+o/s*l})}draw(e,t,i,o){let r=this.pointToCanvas(o);this.vertices.h2=r,this.vertices.h3=r;let s=this.handlersToCanvas(e);this.drawGridSlim(i);let l=t==="h2"?"h3":t==="h3"?"h2":null;for(let y of this.handlersKeys)y===t||y===l||this.drawHandler(this.vertices[y],s[y],this.colors.handler(y,i));this.drawBezier(this.start,r,s.h1,s.h2,i,t!==null),this.drawBezier(r,this.end,s.h3,s.h4,i,t!==null),t!==null&&t!=="center"&&(this.drawActiveHandlerSlim(this.vertices[t],s[t],this.colors.handler(t,i)),l&&this.drawSemiActiveHandlerSlim(this.vertices[l],s[l],this.colors.handler(l,i))),t==="center"?this.drawCenterHandlerActive(r,this.colors.center(i)):this.drawCenterHandler(r,this.colors.center(i),!1);let _=this.canvas.transferToImageBitmap();this.imageContext.transferFromImageBitmap(_)}drawBezier(e,t,i,o,r,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.bezierCurveTo(i.x,i.y,o.x,o.y,t.x,t.y),this.ctx.strokeStyle=this.colors.curve(r),this.ctx.lineWidth=this.config.widthFactor*(s!==null?3:2),this.ctx.stroke(),this.ctx.restore()}drawGridSlim(e){let t=this.colors.grid(e),i=this.size/this.config.virtualSize,o=this.config.virtualSize/this.config.gridLines;this.ctx.save(),this.ctx.beginPath();for(let r=1;r<this.config.gridLines;r++){let s=n.value(r*o*i);this.ctx.moveTo(0,s),this.ctx.lineTo(this.size,s),this.ctx.moveTo(s,0),this.ctx.lineTo(s,this.size)}this.ctx.setLineDash([1,3]),this.ctx.strokeStyle=t.lines,this.ctx.lineWidth=n.value(this.config.widthFactor*.5),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,n.value(i*this.config.virtualSize),n.value(i*this.config.virtualSize)),this.ctx.strokeStyle=t.border,this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.stroke(),this.ctx.restore()}drawCenterHandler(e,t,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=i?t.active:t.main,this.ctx.fillRect(n.value(e.x-this.config.handlerRadius),n.value(e.y-this.config.handlerRadius),n.value(this.config.handlerRadius*2),n.value(this.config.handlerRadius*2)),this.ctx.restore()}drawCenterHandlerActive(e,t){this.ctx.save(),this.ctx.shadowColor=t.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset;let i=n.value(this.config.handlerRadius*3+this.config.widthFactor*2),o=n.value(this.config.handlerRadius*3),r=n.value(this.config.handlerRadius*2);this.ctx.translate(e.x,e.y),this.ctx.beginPath(),this.ctx.rect(i/-2,i/-2,i,i),this.ctx.rect(o/-2,o/-2,o,o),this.ctx.rect(n.value(-this.config.handlerRadius),n.value(-this.config.handlerRadius),r,r),this.ctx.fillStyle=t.active,this.ctx.fill("evenodd"),this.ctx.restore()}drawHandler(e,t,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=i.common.line,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.config.handlerRadius,0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill(),this.ctx.restore()}drawActiveHandlerSlim(e,t,i){this.ctx.save(),this.ctx.shadowColor=i.common.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset,this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=n.value(this.config.widthFactor*1.5),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.strokeStyle=i.common.activeline,this.ctx.stroke(),this.ctx.restore(),this.ctx.translate(t.x,t.y),this.ctx.beginPath(),this.ctx.arc(0,0,this.config.handlerRadius,0,Math.PI*2),this.ctx.arc(0,0,this.config.activeHandlerRadius,0,Math.PI*2,!0),this.ctx.arc(0,0,this.config.activeHandlerRadius+n.value(this.config.widthFactor*2),0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill("evenodd"),this.ctx.restore()}drawSemiActiveHandlerSlim(e,t,i){this.ctx.save(),this.ctx.shadowColor=i.common.shadow,this.ctx.shadowBlur=this.config.activeHandlerShadowBlur,this.ctx.shadowOffsetX=this.config.activeHandlerShadowOffset,this.ctx.shadowOffsetY=this.config.activeHandlerShadowOffset,this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.lineWidth=n.value(this.config.widthFactor*1),this.ctx.strokeStyle=i.common.line,this.ctx.stroke(),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.config.handlerRadius,0,Math.PI*2),this.ctx.fillStyle=i.main,this.ctx.fill(),this.ctx.restore()}pointFromCanvas(e){let t=this.config.virtualSize/this.size;return n.point({x:n.value(Math.max(0,Math.min(e.x,this.size))*t),y:n.value(Math.max(0,Math.min(this.size-e.y,this.size))*t)})}pointToCanvas(e){let t=this.size/this.config.virtualSize;return n.point({x:Math.max(0,Math.min(e.x,this.config.virtualSize))*t,y:this.size-Math.max(0,Math.min(e.y,this.config.virtualSize))*t})}};var b={widthFactor:1,activeHandlerRadius:10,handlerRadius:7,virtualSize:2e3,activeHandlerShadowBlur:7,activeHandlerShadowOffset:5,gridLines:20};var ue={light:{h1:{main:"oklch(0.355 0.146 29)"},h2:{main:"oklch(0.377 0.1 247)"},h3:{main:"oklch(0.355 0.146 29)"},h4:{main:"oklch(0.377 0.1 247)"},common:{line:"#305030",activeline:"#008000",shadow:"#202020"}},dark:{h1:{main:"oklch(0.634 0.254 18)"},h2:{main:"oklch(0.858 0.146 197)"},h3:{main:"oklch(0.634 0.254 18)"},h4:{main:"oklch(0.858 0.146 197)"},common:{line:"#E0FFE0",activeline:"#80FF80",shadow:"#202020"}}},me={light:"#303030",dark:"#D0D0D0"},pe={light:{main:"#606060",active:"#FF5000",shadow:"#404040"},dark:{main:"#A0A0A0",active:"#90F900",shadow:"#202020"}},ve={light:{lines:"#606060",border:"#101010"},dark:{lines:"#C0C0C0",border:"#F0F0F0"}},ge={handlerColors:ue,curveColor:me,gridColors:ve,centerColors:pe},M=class{colors=ge;handler(e,t){let i=t?this.colors.handlerColors.dark:this.colors.handlerColors.light;return{main:i[e].main,common:i.common}}curve(e){return e?this.colors.curveColor.dark:this.colors.curveColor.light}grid(e){return e?this.colors.gridColors.dark:this.colors.gridColors.light}center(e){return e?this.colors.centerColors.dark:this.colors.centerColors.light}};var fe=["canvas"],F=class a{constructor(e){this.renderer=e;T(()=>{this.dibujar(this.state.handlers(),this.state.center(),this.currentHandler(),this.darkMode())})}mouseMoveSubscription=null;moveSubscription=null;startSubscription=null;removeDocumentClickListenerFn=null;removeDocumentTouchEndListenerFn=null;state=f(C);overHandler=c(null);currentHandler=c(null);size=V(200);darkMode=V(!1);canvas;doubleBezier=null;ngAfterViewInit(){this.doubleBezier=new G(this.canvas.nativeElement.getContext("bitmaprenderer"),this.size(),new M,b),this.mouseMoveSubscription=g(this.canvas.nativeElement,"mousemove").pipe(w(()=>this.currentHandler()===null),B(5),H(e=>e)).subscribe(e=>{this.onMouseMove(e)}),this.moveSubscription=A(g(document,"mousemove"),g(document,"touchmove",{passive:!1})).pipe(w(()=>this.currentHandler()!==null),I(e=>e.preventDefault()),B(1),H(e=>e)).subscribe(e=>{this.onMoveHandler(e)}),this.startSubscription=A(g(this.canvas?.nativeElement,"mousedown").pipe(H(e=>e)),g(this.canvas?.nativeElement,"touchstart",{passive:!1}).pipe(H(e=>{let t=this.pointFromEvent(e);return this.isOverHandler(t)!==null?e:null}),w(e=>e!==null),I(e=>e.preventDefault()))).pipe(w(()=>this.currentHandler()===null),B(1)).subscribe(e=>{this.onGrabHandler(e)}),this.canvas.nativeElement.oncontextlost=e=>{console.warn("Context lost",e)},this.dibujar(this.state.handlers())}onDoubleClick(e){let t=this.overHandler();if(t===null||t==="center")return;let i={h1:1,h2:2,h3:4,h4:5},o=n.value(i[t]/6*b.virtualSize);t==="h3"||t==="h4"?this.state.onHandlersChange(x(v({},this.state.handlers()),{[t]:{x:o,y:o}})):this.state.onHandlersChange(x(v({},this.state.handlers()),{[t]:{x:o,y:o}}))}onGrabHandler(e){let t=this.pointFromEvent(e),i=this.isOverHandler(t);i!==null&&this.setHandlerSelected(i)}onMoveHandler(e){let t=this.pointFromEvent(e);this.updateHandlerCoords(t)}onMouseMove(e){let t=this.pointFromEvent(e),i=this.overHandler(),o=this.isOverHandler(t);i!==o&&this.overHandler.set(o)}stopTracking(){this.currentHandler()!==null&&(this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.currentHandler.set(null))}setHandlerSelected(e){this.setListeners(),this.currentHandler.set(e)}updateHandlerCoords(e){let t=this.currentHandler();if(t!==null){if(t==="center"){let i=e.x-this.state.center().x,o=e.y-this.state.center().y,r=this.state.handlers().h2,s=this.state.handlers().h3,l=n.point({x:r.x+i,y:r.y+o}),_=n.point({x:s.x+i,y:s.y+o});this.state.onCenterChange(n.point(e)),this.state.onHandlersChange(x(v({},this.state.handlers()),{h2:l,h3:_}));return}if(t==="h1"||t==="h4")this.state.onHandlersChange(x(v({},this.state.handlers()),{[t]:e}));else{let i=t==="h2"?"h3":"h2",o=this.doubleBezier?.oppositeHandler(this.state.center(),e,this.state.handlers()[i]);this.state.onHandlersChange(x(v({},this.state.handlers()),{[t]:{x:Math.round(e.x),y:Math.round(e.y)},[i]:{x:o.x,y:o.y}}))}}}isOverHandler(e){let t=this.state.handlers(),i=["h1","h2","h3","h4"],o=b.handlerRadius/this.size()*b.virtualSize;for(let r=1;r<=8;r++){if(j(e,this.state.center(),o*r))return"center";for(let s=0;s<i.length;s++){let l=i[s];if(j(e,t[l],o*r))return l}}return null}setListeners(){this.removeDocumentClickListenerFn=this.renderer.listen("document","mouseup",()=>this.stopTracking()),this.removeDocumentTouchEndListenerFn=this.renderer.listen("document","touchend",()=>this.stopTracking(),{passive:!0})}dibujar(e,t=this.state.center(),i=this.currentHandler(),o=this.darkMode()){if(!this.doubleBezier)return;let r=this.doubleBezier;requestAnimationFrame(()=>{r.draw(e,i,o,t)})}pointFromEvent(e){if(!this.doubleBezier)return{x:0,y:0};let t=re.pointFromEvent(this.canvas.nativeElement,e);return this.doubleBezier.pointFromCanvas(t)}ngOnDestroy(){this.removeDocumentClickListenerFn?.(),this.removeDocumentTouchEndListenerFn?.(),this.mouseMoveSubscription?.unsubscribe(),this.moveSubscription?.unsubscribe(),this.startSubscription?.unsubscribe()}static \u0275fac=function(t){return new(t||a)($(W))};static \u0275cmp=z({type:a,selectors:[["zz-double-bezier-panel"]],viewQuery:function(t,i){if(t&1&&X(fe,5),t&2){let o;Y(o=J())&&(i.canvas=o.first)}},inputs:{size:[1,"size"],darkMode:[1,"darkMode"]},decls:3,vars:8,consts:[["canvas",""],["id","canvas",1,"bg-gris-500/20","rounded-lg",3,"dblclick","width","height"]],template:function(t,i){if(t&1){let o=Q();h(0,"div")(1,"canvas",1,0),S("dblclick",function(s){return q(o),K(i.onDoubleClick(s))}),p()()}t&2&&(d(),k("padding",i.size()/20,"px"),P("cursor-grab",i.overHandler()!==null)("cursor-grabbing",i.currentHandler()!==null),m("width",i.size())("height",i.size()))},encapsulation:2,changeDetection:0})};var R=class a{store=f(Z);initialState=this.store.get("double-gradient-state")??ae;angleDegrees=c(this.initialState.angle);startRGBColor=c(this.initialState.colors.start);centerRGBColor=c(this.initialState.colors.center);endRGBColor=c(this.initialState.colors.end);center=c(this.initialState.center);handlers=c(this.initialState.handlers);startOklch=u(()=>E(this.rgbText(this.startRGBColor())));centerOklch=u(()=>E(this.rgbText(this.centerRGBColor())));endOklch=u(()=>E(this.rgbText(this.endRGBColor())));points=u(()=>le.doublePoints(this.handlers(),this.center(),b.virtualSize));startColor=u(()=>this.oklchText(this.startOklch()));centerColor=u(()=>this.oklchText(this.centerOklch()));endColor=u(()=>this.oklchText(this.endOklch()));gradient=u(()=>ne(this.startOklch(),this.centerOklch(),this.endOklch(),this.points(),this.angleDegrees()));currentState=u(()=>({colors:{start:this.startRGBColor(),center:this.centerRGBColor(),end:this.endRGBColor()},center:this.center(),handlers:this.handlers(),angle:this.angleDegrees()}));constructor(){T(()=>this.store.save("double-gradient-state",this.currentState()))}onAngleDegreesChange(e){this.angleDegrees.set(e)}onStartColorChange(e){this.startRGBColor.set(e)}onCenterColorChange(e){this.centerRGBColor.set(e)}onEndColorChange(e){this.endRGBColor.set(e)}onCenterChange(e){this.center.set(e)}onHandlersChange(e){this.handlers.set(v({},e))}rgbText(e){return`rgb(${Math.round(e[0])} ${Math.round(e[1])} ${Math.round(e[2])})`}oklchText(e){return`oklch(${e[0].toFixed(3)} ${e[1].toFixed(3)} ${e[2].toFixed(1)})`}static \u0275fac=function(t){return new(t||a)};static \u0275prov=N({token:a,factory:a.\u0275fac,providedIn:"root"})};var O=class a{state=f(C);onColorEndChange(e){this.state.onEndColorChange(e)}onColorCenterChange(e){this.state.onCenterColorChange(e)}onColorStartChange(e){this.state.onStartColorChange(e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=z({type:a,selectors:[["zz-double-gradient-colors"]],hostAttrs:[1,"w-full"],decls:4,vars:6,consts:[[1,"flex","flex-row","items-center","justify-center","gap-2","w-full"],[1,"shadow-md",3,"color-changing","border","color"]],template:function(t,i){t&1&&(h(0,"div",0)(1,"zz-color-selector",1),S("color-changing",function(r){return i.onColorStartChange(r)}),p(),h(2,"zz-color-selector",1),S("color-changing",function(r){return i.onColorCenterChange(r)}),p(),h(3,"zz-color-selector",1),S("color-changing",function(r){return i.onColorEndChange(r)}),p()()),t&2&&(d(),m("border","border-current/40")("color",i.state.startRGBColor()),d(),m("border","border-current/40")("color",i.state.centerRGBColor()),d(),m("border","border-current/40")("color",i.state.endRGBColor()))},dependencies:[te],encapsulation:2,changeDetection:0})};var de=class a{state=f(C);bezierSize=280;compassSize=130;ngOnInit(){g(document,"touchstart",{passive:!0}).subscribe(()=>{this.requestFullscreen()})}requestFullscreen(){document.fullscreenElement||document.documentElement.requestFullscreen().catch(()=>{console.debug("Error attempting to enable full-screen mode")})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=z({type:a,selectors:[["zz-double-bezier-gradient"]],features:[U([{provide:C,useExisting:R}])],decls:12,vars:10,consts:[[1,"bg-application","w-screen","h-screen","overflow-hidden"],[1,"sticky","bg-application","z-20","top-0","left-0","right-0","shadow-md","dark:shadow-black/60"],[1,"w-screen","min-h-[calc(100vh_-_50px)]","grid","justify-center","place-content-start","auto-rows-auto","gap-4","px-4","pt-[10svh]","pb-8"],[3,"size","darkMode"],[1,"flex","items-center","gap-4","justify-center"],[1,"-ml-1",3,"size","darkMode"],[1,"flex","flex-col","items-center","gap-4","pr-1"]],template:function(t,i){t&1&&(h(0,"div",0)(1,"div",1),D(2,"zz-gradients-header"),p(),h(3,"main",2)(4,"div"),D(5,"zz-double-bezier-panel",3),h(6,"div",4),D(7,"zz-orientation-compass",5),h(8,"div",6),D(9,"zz-double-gradient-colors")(10,"zz-gradient-actions"),p()()()()(),D(11,"zz-notification")),t&2&&(d(3),k("background",i.state.gradient().gradient),P("text-gris-900",!i.state.gradient().darkMode)("text-gris-100",i.state.gradient().darkMode),d(2),m("size",i.bezierSize)("darkMode",i.state.gradient().darkMode),d(2),m("size",i.compassSize)("darkMode",i.state.gradient().darkMode))},dependencies:[ie,oe,ee,F,se,he,O],encapsulation:2,changeDetection:0})};export{de as DoubleBezierGradientComponent};
